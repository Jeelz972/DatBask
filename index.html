<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Suivi Joueuses Basketball - Club F√©minin</title>
    <style>
        /* [Garder tous les styles existants...] */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background: white;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        h1 {
            color: #764ba2;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .basketball-icon {
            font-size: 40px;
        }

        .nav-tabs {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .tab-btn {
            padding: 12px 24px;
            background: #764ba2;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
            font-weight: 500;
        }

        .tab-btn:hover {
            background: #5a3785;
            transform: translateY(-2px);
        }

        .tab-btn.active {
            background: #ff6b6b;
        }

        .content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            min-height: 500px;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .players-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .player-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            border-radius: 12px;
            color: white;
            cursor: pointer;
            transition: transform 0.3s;
            position: relative;
            overflow: hidden;
        }

        .player-card:hover {
            transform: translateY(-5px);
        }

        .player-card h3 {
            margin-bottom: 10px;
            font-size: 20px;
        }

        .player-info {
            font-size: 14px;
            margin: 5px 0;
            opacity: 0.95;
        }

        .player-number {
            position: absolute;
            right: 20px;
            top: 20px;
            font-size: 40px;
            opacity: 0.3;
            font-weight: bold;
        }

        .form-section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 25px;
        }

        .form-section h3 {
            color: #764ba2;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e0e0e0;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            color: #333;
            font-weight: 500;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            padding: 10px 12px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #764ba2;
        }

        .checkbox-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .checkbox-item input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .btn-primary {
            background: #764ba2;
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 20px;
        }

        .btn-primary:hover {
            background: #5a3785;
            transform: translateY(-2px);
        }

        /* Nouveaux styles pour l'import en masse */
        .import-area {
            border: 2px dashed #764ba2;
            border-radius: 10px;
            padding: 40px;
            text-align: center;
            background: #f8f9fa;
            margin: 20px 0;
            transition: all 0.3s;
        }

        .import-area:hover {
            background: #efefef;
        }

        .import-area.dragover {
            background: #e8d4ff;
            border-color: #5a3785;
        }

        .file-input-label {
            display: inline-block;
            background: #764ba2;
            color: white;
            padding: 12px 30px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            margin: 10px;
        }

        .file-input-label:hover {
            background: #5a3785;
        }

        input[type="file"] {
            display: none;
        }

        .import-preview {
            margin-top: 30px;
            overflow-x: auto;
        }

        .import-preview table {
            width: 100%;
            border-collapse: collapse;
        }

        .import-preview th,
        .import-preview td {
            padding: 10px;
            border: 1px solid #e0e0e0;
            text-align: left;
        }

        .import-preview th {
            background: #764ba2;
            color: white;
        }

        .import-preview tr:nth-child(even) {
            background: #f8f9fa;
        }

        .paste-area {
            width: 100%;
            min-height: 200px;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-family: monospace;
            font-size: 12px;
            resize: vertical;
        }

        .suggestion-badge {
            background: #4caf50;
            color: white;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 11px;
            margin-left: 5px;
        }

        .auto-detect-section {
            background: #e8f5e9;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 4px solid #4caf50;
        }

        .auto-detect-section h4 {
            color: #2e7d32;
            margin-bottom: 10px;
        }

        .skill-recommendation {
            display: inline-block;
            padding: 4px 10px;
            margin: 2px;
            border-radius: 12px;
            font-size: 12px;
            background: #f3e5f5;
            color: #6a1b9a;
        }

        .evaluation-grid {
            display: grid;
            gap: 30px;
        }

        .skill-category {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
        }

        .skill-category h4 {
            color: #764ba2;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e0e0e0;
        }

        .skill-item {
            display: grid;
            grid-template-columns: 200px 1fr 80px;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
            padding: 10px;
            background: white;
            border-radius: 6px;
        }

        .skill-name {
            font-weight: 500;
            color: #333;
        }

        .skill-slider {
            width: 100%;
            height: 8px;
            -webkit-appearance: none;
            appearance: none;
            background: #e0e0e0;
            border-radius: 5px;
            outline: none;
        }

        .skill-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: #764ba2;
            border-radius: 50%;
            cursor: pointer;
        }

        .skill-value {
            background: #764ba2;
            color: white;
            padding: 5px 10px;
            border-radius: 6px;
            text-align: center;
            font-weight: bold;
        }

        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-value {
            font-size: 32px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 14px;
            opacity: 0.9;
        }

        .history-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .history-table th,
        .history-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }

        .history-table th {
            background: #f8f9fa;
            color: #764ba2;
            font-weight: 600;
        }

        .history-table tr:hover {
            background: #f8f9fa;
        }

        .badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
        }

        .badge-success {
            background: #4caf50;
            color: white;
        }

        .badge-warning {
            background: #ff9800;
            color: white;
        }

        .badge-danger {
            background: #f44336;
            color: white;
        }

        .badge-info {
            background: #2196f3;
            color: white;
        }

        .search-bar {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .search-bar input {
            flex: 1;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
        }

        .search-bar select {
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 800px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e0e0e0;
        }

        .close-modal {
            font-size: 30px;
            cursor: pointer;
            color: #999;
            transition: color 0.3s;
        }

        .close-modal:hover {
            color: #333;
        }

        .profile-header {
            display: flex;
            gap: 30px;
            margin-bottom: 30px;
            align-items: center;
        }

        .profile-photo {
            width: 150px;
            height: 150px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 48px;
            font-weight: bold;
        }

        .profile-info h2 {
            color: #764ba2;
            margin-bottom: 10px;
        }

        .profile-detail {
            display: grid;
            grid-template-columns: 150px 1fr;
            gap: 10px;
            margin-bottom: 8px;
        }

        .profile-detail strong {
            color: #666;
        }

        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .players-grid {
                grid-template-columns: 1fr;
            }
            
            .skill-item {
                grid-template-columns: 1fr;
                gap: 10px;
            }
            
            .profile-header {
                flex-direction: column;
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>
                <span class="basketball-icon">üèÄ</span>
                Syst√®me de Suivi - Club F√©minin de Basketball
            </h1>
            <div class="nav-tabs">
                <button class="tab-btn active" onclick="switchTab('dashboard', this)">Tableau de Bord</button>
                <button class="tab-btn" onclick="switchTab('players', this)">Joueuses</button>
                <button class="tab-btn" onclick="switchTab('addPlayer', this)">Nouvelle Joueuse</button>
                <button class="tab-btn" onclick="switchTab('importPlayers', this)">Import en Masse</button>
                <button class="tab-btn" onclick="switchTab('evaluation', this)">√âvaluation</button>
                <button class="tab-btn" onclick="switchTab('statistics', this)">Statistiques</button>
                <button class="tab-btn" onclick="switchTab('history', this)">Historique</button>
                <button class="tab-btn" onclick="switchTab('autoProfile', this)">Profils Auto</button>
            </div>
        </header>

        <div class="content">
            <!-- Dashboard Tab (existant) -->
            <div id="dashboard" class="tab-content active">
                <h2>Vue d'ensemble</h2>
                <div class="stats-container">
                    <div class="stat-card">
                        <div class="stat-value" id="totalPlayers">0</div>
                        <div class="stat-label">Joueuses</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="avgRating">0</div>
                        <div class="stat-label">Note Moyenne</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="evalCount">0</div>
                        <div class="stat-label">√âvaluations</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="categories">0</div>
                        <div class="stat-label">Cat√©gories</div>
                    </div>
                </div>

                <h3 style="margin-top: 30px; color: #764ba2;">Derni√®res √âvaluations</h3>
                <table class="history-table">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Joueuse</th>
                            <th>Comp√©tence</th>
                            <th>Progression</th>
                            <th>Note</th>
                        </tr>
                    </thead>
                    <tbody id="recentEvaluations">
                        <tr>
                            <td colspan="5" style="text-align: center; padding: 20px;">Aucune √©valuation r√©cente</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Players List Tab (existant) -->
            <div id="players" class="tab-content">
                <h2>Liste des Joueuses</h2>
                <div class="search-bar">
                    <input type="text" id="searchPlayer" placeholder="Rechercher une joueuse..." onkeyup="filterPlayers()">
                    <select id="filterCategory" onchange="filterPlayers()">
                        <option value="">Toutes les cat√©gories</option>
                        <option value="U15">U15</option>
                        <option value="U18">U18</option>
                        <option value="Seniors">Seniors</option>
                        <option value="Reserve">R√©serve</option>
                        <option value="Bless√©e">Bless√©e</option>
                    </select>
                    <select id="filterTeam" onchange="filterPlayers()">
                        <option value="">Toutes les √©quipes</option>
                        <option value="√âquipe 1">√âquipe 1 - Championnat</option>
                        <option value="√âquipe 2">√âquipe 2 - R√©serve</option>
                        <option value="Espoirs">Espoirs</option>
                        <option value="√âlite">√âlite</option>
                        <option value="D√©veloppement">D√©veloppement</option>
                    </select>
                    <select id="filterPosition" onchange="filterPlayers()">
                        <option value="">Tous les postes</option>
                        <option value="Meneuse">Meneuse</option>
                        <option value="Arri√®re">Arri√®re</option>
                        <option value="Aili√®re">Aili√®re</option>
                        <option value="Aili√®re forte">Aili√®re forte</option>
                        <option value="Pivot">Pivot</option>
                    </select>
                </div>
                <div class="players-grid" id="playersGrid">
                    <!-- Players will be loaded here -->
                </div>
            </div>

            <!-- Add Player Tab (existant mais conserv√©) -->
            <div id="addPlayer" class="tab-content">
                <!-- Contenu existant conserv√© -->
                <h2>Ajouter une Nouvelle Joueuse</h2>
                
                <form id="playerForm" onsubmit="savePlayer(event)">
                    <!-- Tous les champs existants conserv√©s... -->
                    <div class="form-section">
                        <h3>Informations Personnelles</h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label>Pr√©nom *</label>
                                <input type="text" name="firstName" required>
                            </div>
                            <div class="form-group">
                                <label>Nom *</label>
                                <input type="text" name="lastName" required>
                            </div>
                            <div class="form-group">
                                <label>Date de naissance *</label>
                                <input type="date" name="birthDate" required>
                            </div>
                            <div class="form-group">
                                <label>Num√©ro de maillot</label>
                                <input type="number" name="number" min="0" max="99">
                            </div>
                            <div class="form-group">
                                <label>Cat√©gorie *</label>
                                <select name="category" required>
                                    <option value="">S√©lectionner...</option>
                                    <option value="U15">U15</option>
                                    <option value="U18">U18</option>
                                    <option value="Seniors">Seniors</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Cat√©gorie actuelle *</label>
                                <select name="currentCategory" required>
                                    <option value="">S√©lectionner...</option>
                                    <option value="U15">U15</option>
                                    <option value="U18">U18</option>
                                    <option value="Seniors">Seniors</option>
                                    <option value="Reserve">R√©serve</option>
                                    <option value="Bless√©e">Bless√©e</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>√âquipe actuelle *</label>
                                <select name="currentTeam" required>
                                    <option value="">S√©lectionner...</option>
                                    <option value="√âquipe 1">√âquipe 1 - Championnat</option>
                                    <option value="√âquipe 2">√âquipe 2 - R√©serve</option>
                                    <option value="Espoirs">Espoirs</option>
                                    <option value="√âlite">√âlite</option>
                                    <option value="D√©veloppement">D√©veloppement</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <button type="submit" class="btn-primary">Enregistrer la Joueuse</button>
                </form>
            </div>

            <!-- NOUVEAU: Import en Masse Tab -->
            <div id="importPlayers" class="tab-content">
                <h2>Import en Masse de Joueuses</h2>
                
                <div class="form-section">
                    <h3>üìÅ M√©thode 1: Import depuis un fichier CSV</h3>
                    <div class="import-area" id="dropZone">
                        <p style="margin-bottom: 15px;">Glissez-d√©posez votre fichier CSV ici ou</p>
                        <label class="file-input-label">
                            Choisir un fichier
                            <input type="file" id="csvFile" accept=".csv" onchange="handleFileSelect(event)">
                        </label>
                        <p style="margin-top: 15px; font-size: 12px; color: #666;">
                            Format attendu: Pr√©nom, Nom, Date naissance (JJ/MM/AAAA), Num√©ro, Cat√©gorie, √âquipe, Taille (cm), Poste
                        </p>
                    </div>
                    
                    <button class="btn-primary" onclick="downloadTemplate()">üì• T√©l√©charger le mod√®le CSV</button>
                </div>

                <div class="form-section">
                    <h3>üìã M√©thode 2: Copier-coller depuis Excel/Tableur</h3>
                    <textarea class="paste-area" id="pasteArea" placeholder="Collez ici vos donn√©es depuis Excel ou Google Sheets...
Format attendu (s√©par√© par des tabulations):
Pr√©nom    Nom    Date naissance    Num√©ro    Cat√©gorie    √âquipe    Taille    Poste"></textarea>
                    <button class="btn-primary" onclick="processPastedData()">Traiter les donn√©es coll√©es</button>
                </div>

                <div id="importPreview" style="display: none;">
                    <div class="form-section">
                        <h3>‚úÖ Pr√©visualisation de l'import</h3>
                        <p id="importSummary" style="margin-bottom: 15px;"></p>
                        <div class="import-preview">
                            <table id="previewTable">
                                <thead>
                                    <tr>
                                        <th>‚úì</th>
                                        <th>Pr√©nom</th>
                                        <th>Nom</th>
                                        <th>Date naissance</th>
                                        <th>Num√©ro</th>
                                        <th>Cat√©gorie</th>
                                        <th>√âquipe</th>
                                        <th>Taille</th>
                                        <th>Poste</th>
                                        <th>Statut</th>
                                    </tr>
                                </thead>
                                <tbody id="previewBody">
                                </tbody>
                            </table>
                        </div>
                        <div style="margin-top: 20px;">
                            <button class="btn-primary" onclick="confirmImport()">‚úÖ Confirmer l'import</button>
                            <button class="btn-primary" style="background: #f44336;" onclick="cancelImport()">‚ùå Annuler</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- NOUVEAU: Auto Profile Tab -->
            <div id="autoProfile" class="tab-content">
                <h2>D√©termination Automatique des Profils</h2>
                
                <div class="form-section">
                    <h3>ü§ñ Analyse Intelligente des Profils</h3>
                    <p style="margin-bottom: 20px;">
                        Le syst√®me analyse les √©valuations de chaque joueuse pour d√©terminer automatiquement :
                        le poste id√©al, le profil offensif, le profil d√©fensif et les caract√©ristiques dominantes.
                    </p>
                    
                    <div class="form-group">
                        <label>S√©lectionner une joueuse √† analyser</label>
                        <select id="autoProfileSelect" onchange="analyzePlayerProfile()">
                            <option value="">Choisir une joueuse...</option>
                        </select>
                    </div>
                </div>

                <div id="profileAnalysis" style="display: none;">
                    <div class="auto-detect-section">
                        <h4>üìä Analyse des Comp√©tences</h4>
                        <div id="skillAnalysisChart">
                            <!-- Canvas pour le graphique radar sera ajout√© ici -->
                        </div>
                    </div>

                    <div class="form-section">
                        <h3>üéØ Poste Recommand√©</h3>
                        <div id="positionRecommendation">
                            <!-- Recommandations de poste -->
                        </div>
                    </div>

                    <div class="form-section">
                        <h3>‚öîÔ∏è Profil Offensif D√©tect√©</h3>
                        <div id="offensiveProfileAnalysis">
                            <!-- Analyse du profil offensif -->
                        </div>
                    </div>

                    <div class="form-section">
                        <h3>üõ°Ô∏è Profil D√©fensif D√©tect√©</h3>
                        <div id="defensiveProfileAnalysis">
                            <!-- Analyse du profil d√©fensif -->
                        </div>
                    </div>

                    <div class="form-section">
                        <h3>‚≠ê Caract√©ristiques Dominantes</h3>
                        <div id="dominantCharacteristics">
                            <!-- Caract√©ristiques d√©tect√©es -->
                        </div>
                    </div>

                    <button class="btn-primary" onclick="applyAutoProfile()">
                        Appliquer ces recommandations au profil
                    </button>
                </div>

                <div class="form-section" style="margin-top: 30px;">
                    <h3>üîÑ Analyse en Lot</h3>
                    <p>Analyser et mettre √† jour automatiquement les profils de toutes les joueuses √©valu√©es.</p>
                    <button class="btn-primary" onclick="analyzeAllPlayers()">
                        Analyser toutes les joueuses
                    </button>
                    <div id="batchAnalysisResults" style="margin-top: 20px; display: none;">
                        <!-- R√©sultats de l'analyse en lot -->
                    </div>
                </div>
            </div>

            <!-- Evaluation Tab (existant) -->
            <div id="evaluation" class="tab-content">
                <h2>√âvaluation des Comp√©tences</h2>
                
                <div class="form-section">
                    <div class="form-group">
                        <label>S√©lectionner une joueuse</label>
                        <select id="playerSelect" onchange="loadPlayerEvaluation()">
                            <option value="">Choisir une joueuse...</option>
                        </select>
                    </div>
                </div>

                <div id="evaluationForm" style="display: none;">
                    <div class="evaluation-grid">
                        <!-- Comp√©tences Offensives -->
                        <div class="skill-category">
                            <h4>üéØ Tir et Finition</h4>
                            <div class="skill-item">
                                <span class="skill-name">Tir mi-distance</span>
                                <input type="range" class="skill-slider" min="1" max="10" value="5" id="midRangeShot">
                                <span class="skill-value" id="midRangeShotValue">5</span>
                            </div>
                            <div class="skill-item">
                                <span class="skill-name">Tir apr√®s dribble</span>
                                <input type="range" class="skill-slider" min="1" max="10" value="5" id="pullUpShot">
                                <span class="skill-value" id="pullUpShotValue">5</span>
                            </div>
                            <div class="skill-item">
                                <span class="skill-name">Tir √† 3 points</span>
                                <input type="range" class="skill-slider" min="1" max="10" value="5" id="threePointer">
                                <span class="skill-value" id="threePointerValue">5</span>
                            </div>
                            <div class="skill-item">
                                <span class="skill-name">Lay-up main droite</span>
                                <input type="range" class="skill-slider" min="1" max="10" value="5" id="layupRight">
                                <span class="skill-value" id="layupRightValue">5</span>
                            </div>
                            <div class="skill-item">
                                <span class="skill-name">Lay-up main gauche</span>
                                <input type="range" class="skill-slider" min="1" max="10" value="5" id="layupLeft">
                                <span class="skill-value" id="layupLeftValue">5</span>
                            </div>
                            <div class="skill-item">
                                <span class="skill-name">Lancer franc</span>
                                <input type="range" class="skill-slider" min="1" max="10" value="5" id="freeThrow">
                                <span class="skill-value" id="freeThrowValue">5</span>
                            </div>
                            <div class="skill-item">
                                <span class="skill-name">Finition au contact</span>
                                <input type="range" class="skill-slider" min="1" max="10" value="5" id="contactFinish">
                                <span class="skill-value" id="contactFinishValue">5</span>
                            </div>
                            <div class="skill-item">
                                <span class="skill-name">Floater</span>
                                <input type="range" class="skill-slider" min="1" max="10" value="5" id="floater">
                                <span class="skill-value" id="floaterValue">5</span>
                            </div>
                        </div>

                        <!-- Dribble et Cr√©ation -->
                        <div class="skill-category">
                            <h4>üèÄ Dribble et Cr√©ation</h4>
                            <div class="skill-item">
                                <span class="skill-name">Dribble main droite</span>
                                <input type="range" class="skill-slider" min="1" max="10" value="5" id="dribbleRight">
                                <span class="skill-value" id="dribbleRightValue">5</span>
                            </div>
                            <div class="skill-item">
                                <span class="skill-name">Dribble main gauche</span>
                                <input type="range" class="skill-slider" min="1" max="10" value="5" id="dribbleLeft">
                                <span class="skill-value" id="dribbleLeftValue">5</span>
                            </div>
                            <div class="skill-item">
                                <span class="skill-name">Changement de direction</span>
                                <input type="range" class="skill-slider" min="1" max="10" value="5" id="changeDirection">
                                <span class="skill-value" id="changeDirectionValue">5</span>
                            </div>
                            <div class="skill-item">
                                <span class="skill-name">P√©n√©tration</span>
                                <input type="range" class="skill-slider" min="1" max="10" value="5" id="penetration">
                                <span class="skill-value" id="penetrationValue">5</span>
                            </div>
                            <div class="skill-item">
                                <span class="skill-name">Cr√©ation pour soi</span>
                                <input type="range" class="skill-slider" min="1" max="10" value="5" id="createOwnShot">
                                <span class="skill-value" id="createOwnShotValue">5</span>
                            </div>
                            <div class="skill-item">
                                <span class="skill-name">Contr√¥le du ballon</span>
                                <input type="range" class="skill-slider" min="1" max="10" value="5" id="ballControl">
                                <span class="skill-value" id="ballControlValue">5</span>
                            </div>
                        </div>

                        <!-- Passe et Vision de Jeu -->
                        <div class="skill-category">
                            <h4>üëÅÔ∏è Passe et Vision de Jeu</h4>
                            <div class="skill-item">
                                <span class="skill-name">Passe courte</span>
                                <input type="range" class="skill-slider" min="1" max="10" value="5" id="shortPass">
                                <span class="skill-value" id="shortPassValue">5</span>
                            </div>
                            <div class="skill-item">
                                <span class="skill-name">Passe longue</span>
                                <input type="range" class="skill-slider" min="1" max="10" value="5" id="longPass">
                                <span class="skill-value" id="longPassValue">5</span>
                            </div>
                            <div class="skill-item">
                                <span class="skill-name">Vision p√©riph√©rique</span>
                                <input type="range" class="skill-slider" min="1" max="10" value="5" id="peripheralVision">
                                <span class="skill-value" id="peripheralVisionValue">5</span>
                            </div>
                            <div class="skill-item">
                                <span class="skill-name">Lecture du jeu</span>
                                <input type="range" class="skill-slider" min="1" max="10" value="5" id="gameReading">
                                <span class="skill-value" id="gameReadingValue">5</span>
                            </div>
                            <div class="skill-item">
                                <span class="skill-name">Cr√©ation pour les autres</span>
                                <input type="range" class="skill-slider" min="1" max="10" value="5" id="createForOthers">
                                <span class="skill-value" id="createForOthersValue">5</span>
                            </div>
                            <div class="skill-item">
                                <span class="skill-name">Timing de passe</span>
                                <input type="range" class="skill-slider" min="1" max="10" value="5" id="passTiming">
                                <span class="skill-value" id="passTimingValue">5</span>
                            </div>
                        </div>

                        <!-- Comp√©tences D√©fensives -->
                        <div class="skill-category">
                            <h4>üõ°Ô∏è Comp√©tences D√©fensives</h4>
                            <div class="skill-item">
                                <span class="skill-name">D√©fense individuelle</span>
                                <input type="range" class="skill-slider" min="1" max="10" value="5" id="manDefense">
                                <span class="skill-value" id="manDefenseValue">5</span>
                            </div>
                            <div class="skill-item">
                                <span class="skill-name">Aide d√©fensive</span>
                                <input type="range" class="skill-slider" min="1" max="10" value="5" id="helpDefense">
                                <span class="skill-value" id="helpDefenseValue">5</span>
                            </div>
                            <div class="skill-item">
                                <span class="skill-name">Interception</span>
                                <input type="range" class="skill-slider" min="1" max="10" value="5" id="steal">
                                <span class="skill-value" id="stealValue">5</span>
                            </div>
                            <div class="skill-item">
                                <span class="skill-name">Contre</span>
                                <input type="range" class="skill-slider" min="1" max="10" value="5" id="block">
                                <span class="skill-value" id="blockValue">5</span>
                            </div>
                            <div class="skill-item">
                                <span class="skill-name">Rebond d√©fensif</span>
                                <input type="range" class="skill-slider" min="1" max="10" value="5" id="defensiveRebound">
                                <span class="skill-value" id="defensiveReboundValue">5</span>
                            </div>
                            <div class="skill-item">
                                <span class="skill-name">Communication d√©fensive</span>
                                <input type="range" class="skill-slider" min="1" max="10" value="5" id="defensiveCommunication">
                                <span class="skill-value" id="defensiveCommunicationValue">5</span>
                            </div>
                            <div class="skill-item">
                                <span class="skill-name">D√©fense p√©rim√®tre</span>
                                <input type="range" class="skill-slider" min="1" max="10" value="5" id="perimeterDefense">
                                <span class="skill-value" id="perimeterDefenseValue">5</span>
                            </div>
                            <div class="skill-item">
                                <span class="skill-name">D√©fense poste bas</span>
                                <input type="range" class="skill-slider" min="1" max="10" value="5" id="postDefense">
                                <span class="skill-value" id="postDefenseValue">5</span>
                            </div>
                        </div>

                        <!-- Jeu Int√©rieur -->
                        <div class="skill-category">
                            <h4>üí™ Jeu Int√©rieur</h4>
                            <div class="skill-item">
                                <span class="skill-name">Jeu dos au panier</span>
                                <input type="range" class="skill-slider" min="1" max="10" value="5" id="postUp">
                                <span class="skill-value" id="postUpValue">5</span>
                            </div>
                            <div class="skill-item">
                                <span class="skill-name">Hook shot</span>
                                <input type="range" class="skill-slider" min="1" max="10" value="5" id="hookShot">
                                <span class="skill-value" id="hookShotValue">5</span>
                            </div>
                            <div class="skill-item">
                                <span class="skill-name">Rebond offensif</span>
                                <input type="range" class="skill-slider" min="1" max="10" value="5" id="offensiveRebound">
                                <span class="skill-value" id="offensiveReboundValue">5</span>
                            </div>
                            <div class="skill-item">
                                <span class="skill-name">√âcrans</span>
                                <input type="range" class="skill-slider" min="1" max="10" value="5" id="screening">
                                <span class="skill-value" id="screeningValue">5</span>
                            </div>
                        </div>

                        <!-- Aspects Physiques -->
                        <div class="skill-category">
                            <h4>‚ö° Aspects Physiques</h4>
                            <div class="skill-item">
                                <span class="skill-name">Vitesse</span>
                                <input type="range" class="skill-slider" min="1" max="10" value="5" id="speed">
                                <span class="skill-value" id="speedValue">5</span>
                            </div>
                            <div class="skill-item">
                                <span class="skill-name">Explosivit√©</span>
                                <input type="range" class="skill-slider" min="1" max="10" value="5" id="explosiveness">
                                <span class="skill-value" id="explosivenessValue">5</span>
                            </div>
                            <div class="skill-item">
                                <span class="skill-name">Agilit√©</span>
                                <input type="range" class="skill-slider" min="1" max="10" value="5" id="agility">
                                <span class="skill-value" id="agilityValue">5</span>
                            </div>
                            <div class="skill-item">
                                <span class="skill-name">Force</span>
                                <input type="range" class="skill-slider" min="1" max="10" value="5" id="strength">
                                <span class="skill-value" id="strengthValue">5</span>
                            </div>
                           <div class="skill-item">
                                <span class="skill-name">Endurance</span>
                                <input type="range" class="skill-slider" min="1" max="10" value="5" id="endurance">
                                <span class="skill-value" id="enduranceValue">5</span>
                            </div>
                            <div class="skill-item">
                                <span class="skill-name">Coordination</span>
                                <input type="range" class="skill-slider" min="1" max="10" value="5" id="coordination">
                                <span class="skill-value" id="coordinationValue">5</span>
                            </div>
                            <div class="skill-item">
                                <span class="skill-name">√âquilibre</span>
                                <input type="range" class="skill-slider" min="1" max="10" value="5" id="balance">
                                <span class="skill-value" id="balanceValue">5</span>
                            </div>
                        </div>

                        <!-- Aspects Mentaux -->
                        <div class="skill-category">
                            <h4>üß† Aspects Mentaux</h4>
                            <div class="skill-item">
                                <span class="skill-name">Concentration</span>
                                <input type="range" class="skill-slider" min="1" max="10" value="5" id="concentration">
                                <span class="skill-value" id="concentrationValue">5</span>
                            </div>
                            <div class="skill-item">
                                <span class="skill-name">Leadership</span>
                                <input type="range" class="skill-slider" min="1" max="10" value="5" id="leadership">
                                <span class="skill-value" id="leadershipValue">5</span>
                            </div>
                            <div class="skill-item">
                                <span class="skill-name">Esprit d'√©quipe</span>
                                <input type="range" class="skill-slider" min="1" max="10" value="5" id="teamSpirit">
                                <span class="skill-value" id="teamSpiritValue">5</span>
                            </div>
                            <div class="skill-item">
                                <span class="skill-name">Gestion de la pression</span>
                                <input type="range" class="skill-slider" min="1" max="10" value="5" id="pressureManagement">
                                <span class="skill-value" id="pressureManagementValue">5</span>
                            </div>
                            <div class="skill-item">
                                <span class="skill-name">Combativit√©</span>
                                <input type="range" class="skill-slider" min="1" max="10" value="5" id="fighting">
                                <span class="skill-value" id="fightingValue">5</span>
                            </div>
                            <div class="skill-item">
                                <span class="skill-name">Discipline tactique</span>
                                <input type="range" class="skill-slider" min="1" max="10" value="5" id="tacticalDiscipline">
                                <span class="skill-value" id="tacticalDisciplineValue">5</span>
                            </div>
                        </div>
                    </div>

                    <div class="form-section" style="margin-top: 30px;">
                        <h3>Observations et Commentaires</h3>
                        <div class="form-group">
                            <label>Notes de l'entra√Æneur</label>
                            <textarea id="coachNotes" rows="4" style="width: 100%; resize: vertical;" placeholder="Points forts, axes d'am√©lioration, observations particuli√®res..."></textarea>
                        </div>
                        <div class="form-group">
                            <label>Objectifs √† court terme</label>
                            <textarea id="shortTermGoals" rows="3" style="width: 100%; resize: vertical;" placeholder="Objectifs pour les prochaines semaines..."></textarea>
                        </div>
                    </div>

                    <button type="button" class="btn-primary" onclick="saveEvaluation()">Enregistrer l'√âvaluation</button>
                </div>
            </div>

            <!-- Statistics Tab -->
            <div id="statistics" class="tab-content">
                <h2>Statistiques et Analyses</h2>
                
                <div class="form-section">
                    <div class="form-grid">
                        <div class="form-group">
                            <label>S√©lectionner une joueuse</label>
                            <select id="statsPlayerSelect" onchange="loadPlayerStats()">
                                <option value="">Toutes les joueuses</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>P√©riode</label>
                            <select id="statsPeriod" onchange="loadPlayerStats()">
                                <option value="all">Toute la saison</option>
                                <option value="month">Dernier mois</option>
                                <option value="3months">3 derniers mois</option>
                                <option value="6months">6 derniers mois</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div id="statsContent" style="display: none;">
                    <div class="stats-container">
                        <div class="stat-card">
                            <div class="stat-value" id="avgOffensive">0</div>
                            <div class="stat-label">Moyenne Offensive</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="avgDefensive">0</div>
                            <div class="stat-label">Moyenne D√©fensive</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="avgPhysical">0</div>
                            <div class="stat-label">Moyenne Physique</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="avgMental">0</div>
                            <div class="stat-label">Moyenne Mentale</div>
                        </div>
                    </div>

                    <div class="form-section" style="margin-top: 30px;">
                        <h3>Graphique Radar des Comp√©tences</h3>
                        <canvas id="radarChart" class="radar-chart"></canvas>
                    </div>

                    <div class="form-section">
                        <h3>Points Forts / Points Faibles</h3>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                            <div>
                                <h4 style="color: #4caf50; margin-bottom: 15px;">‚úÖ Top 5 Comp√©tences</h4>
                                <div id="topSkills"></div>
                            </div>
                            <div>
                                <h4 style="color: #f44336; margin-bottom: 15px;">‚ö†Ô∏è Axes d'Am√©lioration</h4>
                                <div id="weakSkills"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- History Tab -->
            <div id="history" class="tab-content">
                <h2>Historique des Modifications</h2>
                
                <div class="search-bar">
                    <input type="text" id="searchHistory" placeholder="Rechercher dans l'historique..." onkeyup="filterHistory()">
                    <select id="filterHistoryType" onchange="filterHistory()">
                        <option value="">Tous les types</option>
                        <option value="creation">Cr√©ation</option>
                        <option value="evaluation">√âvaluation</option>
                        <option value="modification">Modification</option>
                        <option value="import">Import</option>
                        <option value="auto-profile">Profil Auto</option>
                    </select>
                    <input type="date" id="filterHistoryDate" onchange="filterHistory()">
                </div>

                <table class="history-table">
                    <thead>
                        <tr>
                            <th>Date & Heure</th>
                            <th>Type</th>
                            <th>Joueuse</th>
                            <th>Description</th>
                            <th>Utilisateur</th>
                        </tr>
                    </thead>
                    <tbody id="historyTable">
                        <tr>
                            <td colspan="5" style="text-align: center; padding: 20px;">Aucun historique disponible</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Player Profile Modal -->
    <div id="playerModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalPlayerName">Profil de la Joueuse</h2>
                <span class="close-modal" onclick="closeModal()">&times;</span>
            </div>
            
            <div class="profile-header">
                <div class="profile-photo" id="modalPlayerPhoto">
                    <span id="modalPlayerInitials">--</span>
                </div>
                <div class="profile-info">
                    <h2 id="modalFullName">--</h2>
                    <div class="profile-detail">
                        <strong>Num√©ro:</strong>
                        <span id="modalNumber">--</span>
                    </div>
                    <div class="profile-detail">
                        <strong>Poste:</strong>
                        <span id="modalPosition">--</span>
                    </div>
                    <div class="profile-detail">
                        <strong>Cat√©gorie:</strong>
                        <span id="modalCategory">--</span>
                    </div>
                    <div class="profile-detail">
                        <strong>√Çge:</strong>
                        <span id="modalAge">--</span>
                    </div>
                </div>
            </div>

            <div class="form-section">
                <h3>Profil de Jeu</h3>
                <div class="profile-detail">
                    <strong>Profil Offensif:</strong>
                    <span id="modalOffensive">--</span>
                </div>
                <div class="profile-detail">
                    <strong>Profil D√©fensif:</strong>
                    <span id="modalDefensive">--</span>
                </div>
                <div class="profile-detail">
                    <strong>Caract√©ristiques:</strong>
                    <span id="modalCharacteristics">--</span>
                </div>
            </div>

            <div class="form-section">
                <h3>Derni√®re √âvaluation</h3>
                <canvas id="modalRadarChart" style="width: 100%; max-width: 400px; margin: 0 auto;"></canvas>
                <p style="text-align: center; margin-top: 15px; color: #666;">
                    Note globale: <strong id="modalGlobalRating">--</strong>/10
                </p>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        
        // ==================== DONN√âES ET VARIABLES GLOBALES ====================
        let players = JSON.parse(localStorage.getItem('basketballPlayers')) || [];
        let evaluations = JSON.parse(localStorage.getItem('playerEvaluations')) || {};
        let history = JSON.parse(localStorage.getItem('historyLog')) || [];
        let currentPlayerId = null;
        let importData = [];
        let radarChart = null;
        let modalRadarChart = null;
        let profileRadarChart = null;


        // ==================== SYST√àME D'IMPORT EN MASSE ====================

        // ==================== CORRECTIONS DES ERREURS ====================

        // S'assurer que switchTab est d√©finie globalement AVANT son utilisation
        window.switchTab = function(tabName, buttonElement) {
            // Masquer tous les contenus d'onglets
            const tabs = document.querySelectorAll('.tab-content');
            tabs.forEach(tab => tab.classList.remove('active'));
            
            // D√©sactiver tous les boutons d'onglets
            const buttons = document.querySelectorAll('.tab-btn');
            buttons.forEach(btn => btn.classList.remove('active'));
            
            // Afficher l'onglet s√©lectionn√©
            const targetTab = document.getElementById(tabName);
            if (targetTab) {
                targetTab.classList.add('active');
            }
            
            // Activer le bouton correspondant
            if (buttonElement) {
                buttonElement.classList.add('active');
            }
            
            // Charger les donn√©es sp√©cifiques √† l'onglet
            switch(tabName) {
                case 'dashboard':
                    if (typeof loadDashboard === 'function') loadDashboard();
                    break;
                case 'players':
                    if (typeof loadPlayers === 'function') loadPlayers();
                    break;
                case 'evaluation':
                    if (typeof loadEvaluationPlayers === 'function') loadEvaluationPlayers();
                    break;
                case 'statistics':
                    if (typeof loadStatisticsPlayers === 'function') loadStatisticsPlayers();
                    break;
                case 'history':
                    if (typeof loadHistory === 'function') loadHistory();
                    break;
                case 'autoProfile':
                    if (typeof loadAutoProfilePlayers === 'function') loadAutoProfilePlayers();
                    break;
                case 'importPlayers':
                    // Pas de fonction de chargement sp√©cifique
                    break;
                case 'addPlayer':
                    // Pas de fonction de chargement sp√©cifique
                    break;
            }
        };
        
        // D√©finir √©galement la fonction switchTab normalement pour les appels internes
        function switchTab(tabName, buttonElement) {
            window.switchTab(tabName, buttonElement);
        }
        
        // G√©rer le drag & drop
        const dropZone = document.getElementById('dropZone');
        if (dropZone) {
            dropZone.addEventListener('dragover', (e) => {
                e.preventDefault();
                dropZone.classList.add('dragover');
            });
            
            dropZone.addEventListener('dragleave', () => {
                dropZone.classList.remove('dragover');
            });
            
            dropZone.addEventListener('drop', (e) => {
                e.preventDefault();
                dropZone.classList.remove('dragover');
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    handleFileSelect({ target: { files: files } });
                }
            });
        }

        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const content = e.target.result;
                parseCSV(content);
            };
            reader.readAsText(file);
        }

        function parseCSV(content) {
            const lines = content.split('\n').filter(line => line.trim());
            const headers = lines[0].split(',').map(h => h.trim());
            
            importData = [];
            for (let i = 1; i < lines.length; i++) {
                const values = lines[i].split(',').map(v => v.trim());
                const player = {
                    firstName: values[0] || '',
                    lastName: values[1] || '',
                    birthDate: convertDateFormat(values[2] || ''),
                    number: values[3] || '',
                    category: values[4] || '',
                    currentTeam: values[5] || '',
                    height: values[6] || '',
                    primaryPosition: values[7] || '',
                    status: 'valid'
                };
                
                // Validation basique
                if (!player.firstName || !player.lastName) {
                    player.status = 'invalid';
                }
                
                importData.push(player);
            }
            
            displayImportPreview();
        }

        function processPastedData() {
            const pasteArea = document.getElementById('pasteArea');
            const content = pasteArea.value;
            
            if (!content.trim()) {
                alert('Veuillez coller des donn√©es dans la zone de texte');
                return;
            }
            
            const lines = content.split('\n').filter(line => line.trim());
            importData = [];
            
            for (let i = 0; i < lines.length; i++) {
                const values = lines[i].split('\t').map(v => v.trim());
                
                if (values.length < 3) continue;
                
                const player = {
                    firstName: values[0] || '',
                    lastName: values[1] || '',
                    birthDate: convertDateFormat(values[2] || ''),
                    number: values[3] || '',
                    category: values[4] || 'Seniors',
                    currentTeam: values[5] || '√âquipe 1',
                    height: values[6] || '',
                    primaryPosition: values[7] || '',
                    status: 'valid'
                };
                
                // Validation
                if (!player.firstName || !player.lastName) {
                    player.status = 'invalid';
                }
                
                importData.push(player);
            }
            
            if (importData.length === 0) {
                alert('Aucune donn√©e valide trouv√©e');
                return;
            }
            
            displayImportPreview();
        }

       function displayImportPreview() {
    const previewSection = document.getElementById('importPreview');
    const tbody = document.getElementById('previewBody');
    const summary = document.getElementById('importSummary');
    
    if (!previewSection || !tbody || !summary) return;
    
    const validCount = importData.filter(p => p.status === 'valid').length;
    const invalidCount = importData.filter(p => p.status === 'invalid').length;
    
    summary.innerHTML = `
        <strong>${importData.length}</strong> joueuses d√©tect√©es 
        (<span style="color: #4caf50;">${validCount} valides</span>, 
        <span style="color: #f44336;">${invalidCount} invalides</span>)
    `;
    
    tbody.innerHTML = importData.map((player, index) => `
        <tr style="${player.status === 'invalid' ? 'background: #ffebee;' : ''}">
            <td>
                <input type="checkbox" 
                       id="import_${index}" 
                       ${player.status === 'valid' ? 'checked' : ''}
                       ${player.status === 'invalid' ? 'disabled' : ''}>
            </td>
            <td>${player.firstName}</td>
            <td>${player.lastName}</td>
            <td>${player.birthDate}</td>
            <td>${player.number || '--'}</td>
            <td>${player.category}</td>
            <td>${player.currentTeam}</td>
            <td>${player.height || '--'}</td>
            <td>${player.primaryPosition || 'Auto'}</td>
            <td>
                <span class="badge ${player.status === 'valid' ? 'badge-success' : 'badge-danger'}">
                    ${player.status === 'valid' ? 'Valide' : 'Invalide'}
                </span>
            </td>
        </tr>
    `).join('');
    
    previewSection.style.display = 'block';
}

function confirmImport() {
    const selectedPlayers = [];
    
    importData.forEach((player, index) => {
        const checkbox = document.getElementById(`import_${index}`);
        if (checkbox && checkbox.checked) {
            const newPlayer = {
                id: Date.now().toString() + '_' + index,
                ...player,
                currentCategory: player.category,
                joinDate: new Date().toISOString().split('T')[0],
                createdAt: new Date().toISOString()
            };
            delete newPlayer.status;
            selectedPlayers.push(newPlayer);
        }
    });
    
    if (selectedPlayers.length === 0) {
        alert('Aucune joueuse s√©lectionn√©e pour l\'import');
        return;
    }
    
    // Ajouter les joueuses
    players.push(...selectedPlayers);
    localStorage.setItem('basketballPlayers', JSON.stringify(players));
    
    // Ajouter √† l'historique
    selectedPlayers.forEach(player => {
        addToHistory('import', player, `Import en masse - ${player.firstName} ${player.lastName}`);
    });
    
    alert(`${selectedPlayers.length} joueuse(s) import√©e(s) avec succ√®s !`);
    
    // R√©initialiser
    cancelImport();
    
    // Rafra√Æchir la vue
    switchTab('players', document.querySelector('.tab-btn:nth-child(2)'));
}

function cancelImport() {
    document.getElementById('importPreview').style.display = 'none';
    document.getElementById('pasteArea').value = '';
    document.getElementById('csvFile').value = '';
    importData = [];
}

function downloadTemplate() {
    const template = `Pr√©nom,Nom,Date naissance,Num√©ro,Cat√©gorie,√âquipe,Taille,Poste
Marie,Dupont,15/03/2008,7,U15,√âquipe 1,165,Meneuse
Sophie,Martin,22/11/2007,12,U18,√âquipe 2,172,Arri√®re
L√©a,Bernard,08/05/2005,23,Seniors,√âlite,180,Aili√®re`;
    
    const blob = new Blob([template], { type: 'text/csv;charset=utf-8;' });
    const link = document.createElement('a');
    link.href = URL.createObjectURL(blob);
    link.download = 'modele_import_joueuses.csv';
    link.click();
}

function convertDateFormat(dateStr) {
    if (!dateStr) return '';
    
    // Format JJ/MM/AAAA vers AAAA-MM-JJ
    if (dateStr.includes('/')) {
        const parts = dateStr.split('/');
        if (parts.length === 3) {
            return `${parts[2]}-${parts[1].padStart(2, '0')}-${parts[0].padStart(2, '0')}`;
        }
    }
    return dateStr;
}

// ==================== SYST√àME DE PROFIL AUTOMATIQUE ====================

function analyzePlayerProfile() {
    const playerId = document.getElementById('autoProfileSelect').value;
    if (!playerId) {
        document.getElementById('profileAnalysis').style.display = 'none';
        return;
    }
    
    const player = players.find(p => p.id === playerId);
    const playerEvals = evaluations[playerId];
    
    if (!playerEvals || playerEvals.length === 0) {
        document.getElementById('profileAnalysis').innerHTML = `
            <div class="form-section">
                <p style="text-align: center; color: #666;">
                    Aucune √©valuation disponible pour ${player.firstName} ${player.lastName}.
                    Veuillez d'abord effectuer une √©valuation.
                </p>
            </div>
        `;
        document.getElementById('profileAnalysis').style.display = 'block';
        return;
    }
    
    // Utiliser la derni√®re √©valuation
    const lastEval = playerEvals[playerEvals.length - 1];
    const analysis = performProfileAnalysis(player, lastEval.skills);
    
    displayProfileAnalysis(player, analysis);
    document.getElementById('profileAnalysis').style.display = 'block';
}

function performProfileAnalysis(player, skills) {
    const analysis = {
        position: determineOptimalPosition(player, skills),
        offensiveProfile: determineOffensiveProfile(skills),
        defensiveProfile: determineDefensiveProfile(skills),
        characteristics: determineDominantCharacteristics(skills),
        strengths: [],
        weaknesses: [],
        recommendations: []
    };
    
    // Identifier les forces et faiblesses
    const skillArray = Object.entries(skills).map(([key, value]) => ({
        name: key,
        value: value
    }));
    
    skillArray.sort((a, b) => b.value - a.value);
    analysis.strengths = skillArray.slice(0, 5);
    analysis.weaknesses = skillArray.filter(s => s.value < 5).slice(0, 3);
    
    // Recommandations bas√©es sur l'analyse
    analysis.recommendations = generateRecommendations(analysis, skills);
    
    return analysis;
}

function determineOptimalPosition(player, skills) {
    const height = parseInt(player.height) || 175;
    const positions = [];
    
    // Calcul des scores pour chaque poste
    const meneuseScore = calculatePointGuardScore(height, skills);
    const arriereScore = calculateShootingGuardScore(height, skills);
    const ailiereScore = calculateSmallForwardScore(height, skills);
    const ailiereFortScore = calculatePowerForwardScore(height, skills);
    const pivotScore = calculateCenterScore(height, skills);
    
    positions.push(
        { name: 'Meneuse', score: meneuseScore, reason: 'Excellente vision de jeu et contr√¥le du ballon' },
        { name: 'Arri√®re', score: arriereScore, reason: 'Bon tir ext√©rieur et cr√©ation de jeu' },
        { name: 'Aili√®re', score: ailiereScore, reason: 'Polyvalence offensive et d√©fensive' },
        { name: 'Aili√®re forte', score: ailiereFortScore, reason: 'Force physique et jeu int√©rieur/ext√©rieur' },
        { name: 'Pivot', score: pivotScore, reason: 'Domination dans la raquette et protection du cercle' }
    );
    
    positions.sort((a, b) => b.score - a.score);
    
    return {
        primary: positions[0],
        secondary: positions[1].score > 60 ? positions[1] : null,
        all: positions
    };
}

function calculatePointGuardScore(height, skills) {
    let score = 0;
    
    // Taille id√©ale pour meneuse
    if (height < 175) score += 20;
    else if (height < 180) score += 10;
    
    // Comp√©tences critiques pour une meneuse
    score += (skills.ballControl || 5) * 3;
    score += (skills.shortPass || 5) * 3;
    score += (skills.longPass || 5) * 2;
    score += (skills.peripheralVision || 5) * 3;
    score += (skills.gameReading || 5) * 3;
    score += (skills.createForOthers || 5) * 3;
    score += (skills.dribbleRight || 5) * 2;
    score += (skills.dribbleLeft || 5) * 2;
    score += (skills.speed || 5) * 2;
    score += (skills.leadership || 5) * 2;
    
    return Math.min(100, score);
}

function calculateShootingGuardScore(height, skills) {
    let score = 0;
    
    // Taille id√©ale pour arri√®re
    if (height >= 170 && height <= 180) score += 20;
    else if (height > 165 && height < 185) score += 10;
    
    // Comp√©tences critiques pour une arri√®re
    score += (skills.threePointer || 5) * 3;
    score += (skills.midRangeShot || 5) * 3;
    score += (skills.pullUpShot || 5) * 3;
    score += (skills.createOwnShot || 5) * 3;
    score += (skills.freeThrow || 5) * 2;
    score += (skills.penetration || 5) * 2;
    score += (skills.speed || 5) * 2;
    score += (skills.agility || 5) * 2;
    
    return Math.min(100, score);
}

function calculateSmallForwardScore(height, skills) {
    let score = 0;
    
    // Taille id√©ale pour aili√®re
    if (height >= 175 && height <= 185) score += 20;
    else if (height > 170 && height < 190) score += 10;
    
    // Comp√©tences - polyvalence requise
    score += (skills.midRangeShot || 5) * 2;
    score += (skills.threePointer || 5) * 2;
    score += (skills.penetration || 5) * 2;
    score += (skills.layupRight || 5) * 2;
    score += (skills.layupLeft || 5) * 2;
    score += (skills.defensiveRebound || 5) * 2;
    score += (skills.manDefense || 5) * 2;
    score += (skills.speed || 5) * 2;
    score += (skills.agility || 5) * 2;
    score += (skills.coordination || 5) * 2;
    
    return Math.min(100, score);
}

function calculatePowerForwardScore(height, skills) {
    let score = 0;
    
    // Taille id√©ale pour aili√®re forte
    if (height >= 180 && height <= 190) score += 20;
    else if (height > 175) score += 10;
    
    // Comp√©tences
    score += (skills.strength || 5) * 3;
    score += (skills.postUp || 5) * 3;
    score += (skills.defensiveRebound || 5) * 3;
    score += (skills.offensiveRebound || 5) * 2;
    score += (skills.midRangeShot || 5) * 2;
    score += (skills.screening || 5) * 2;
    score += (skills.contactFinish || 5) * 2;
    score += (skills.postDefense || 5) * 2;
    
    return Math.min(100, score);
}

function calculateCenterScore(height, skills) {
    let score = 0;
    
    // Taille id√©ale pour pivot
    if (height > 185) score += 25;
    else if (height > 180) score += 15;
    
    // Comp√©tences
    score += (skills.postUp || 5) * 3;
    score += (skills.hookShot || 5) * 3;
    score += (skills.defensiveRebound || 5) * 3;
    score += (skills.offensiveRebound || 5) * 3;
    score += (skills.block || 5) * 3;
    score += (skills.strength || 5) * 3;
    score += (skills.screening || 5) * 2;
    score += (skills.postDefense || 5) * 3;
    score += (skills.contactFinish || 5) * 2;
    
    return Math.min(100, score);
}

function determineOffensiveProfile(skills) {
    const profiles = [];
    
    // Scoreuse int√©rieure
    const interiorScore = (
        (skills.contactFinish || 5) +
        (skills.postUp || 5) +
        (skills.hookShot || 5) +
        (skills.layupRight || 5) +
        (skills.layupLeft || 5)
    ) / 5;
    
    if (interiorScore > 7) {
        profiles.push({
            type: 'Scoreuse int√©rieure',
            score: interiorScore,
            description: 'Excellente finition pr√®s du cercle et jeu dos au panier'
        });
    }
    
    // Scoreuse ext√©rieure
    const exteriorScore = (
        (skills.threePointer || 5) +
        (skills.midRangeShot || 5) +
        (skills.pullUpShot || 5) +
        (skills.freeThrow || 5)
    ) / 4;
    
    if (exteriorScore > 7) {
        profiles.push({
            type: 'Scoreuse ext√©rieure',
            score: exteriorScore,
            description: 'Tir longue distance et mi-distance efficace'
        });
    }
    
    // Cr√©atrice
    const creatorScore = (
        (skills.shortPass || 5) +
        (skills.longPass || 5) +
        (skills.peripheralVision || 5) +
        (skills.createForOthers || 5) +
        (skills.gameReading || 5)
    ) / 5;
    
    if (creatorScore > 7) {
        profiles.push({
            type: 'Cr√©atrice',
            score: creatorScore,
            description: 'Vision de jeu exceptionnelle et cr√©ation pour les co√©quipi√®res'
        });
    }
    
    // Shooteuse
    const shooterScore = (
        (skills.threePointer || 5) +
        (skills.midRangeShot || 5) +
        (skills.freeThrow || 5) +
        (skills.floater || 5)
    ) / 4;
    
    if (shooterScore > 7.5) {
        profiles.push({
            type: 'Shooteuse',
            score: shooterScore,
            description: 'Adresse remarquable √† toutes distances'
        });
    }
    
    // Slasheuse
    const slasherScore = (
        (skills.penetration || 5) +
        (skills.speed || 5) +
        (skills.layupRight || 5) +
        (skills.layupLeft || 5) +
        (skills.contactFinish || 5)
    ) / 5;
    
    if (slasherScore > 7) {
        profiles.push({
            type: 'Slasheuse',
            score: slasherScore,
            description: 'P√©n√©tration explosive et finition au contact'
        });
    }
    
    // Post-up player
    const postScore = (
        (skills.postUp || 5) +
        (skills.hookShot || 5) +
        (skills.strength || 5) +
        (skills.screening || 5)
    ) / 4;
    
    if (postScore > 7) {
        profiles.push({
            type: 'Post-up player',
            score: postScore,
            description: 'Domination dans le jeu dos au panier'
        });
    }
    
    // Si aucun profil sp√©cifique, d√©terminer le plus proche
    if (profiles.length === 0) {
        const allScores = [
            { type: 'Polyvalente', score: 5, description: 'Profil √©quilibr√© sans sp√©cialisation marqu√©e' }
        ];
        return allScores[0];
    }
    
    profiles.sort((a, b) => b.score - a.score);
    return profiles[0];
}

function determineDefensiveProfile(skills) {
    const profiles = [];
    
    // Lock defender
    if ((skills.manDefense || 5) > 8) {
        profiles.push({
            type: 'Lock defender',
            score: skills.manDefense,
            description: 'D√©fense individuelle d\'√©lite'
        });
    }
    
    // Rim protector
    const rimScore = ((skills.block || 5) + (skills.postDefense || 5)) / 2;
    if (rimScore > 7) {
        profiles.push({
            type: 'Rim protector',
            score: rimScore,
            description: 'Protection du cercle et intimidation'
        });
    }
    
    // D√©fenseuse p√©rim√®tre
    const perimeterScore = (
        (skills.perimeterDefense || 5) +
        (skills.agility || 5) +
        (skills.speed || 5)
    ) / 3;
    
    if (perimeterScore > 7) {
        profiles.push({
            type: 'D√©fenseuse p√©rim√®tre',
            score: perimeterScore,
            description: 'Excellente d√©fense sur les ext√©rieures'
        });
    }
    
    // Voleuse de ballon
    if ((skills.steal || 5) > 7) {
        profiles.push({
            type: 'Voleuse de ballon',
            score: skills.steal,
            description: 'Capacit√© √† cr√©er des turnovers'
        });
    }
    
    // Rebondeuse
    const reboundScore = (
        (skills.defensiveRebound || 5) +
        (skills.offensiveRebound || 5)
    ) / 2;
    
    if (reboundScore > 7) {
        profiles.push({
            type: 'Rebondeuse',
            score: reboundScore,
            description: 'Domination aux rebonds'
        });
    }
    
    if (profiles.length === 0) {
        return {
            type: 'D√©fenseuse polyvalente',
            score: 5,
            description: 'D√©fense solide sans sp√©cialisation'
        };
    }
    
    profiles.sort((a, b) => b.score - a.score);
    return profiles[0];
}

function determineDominantCharacteristics(skills) {
    const characteristics = [];
    
    // Analyser chaque cat√©gorie de comp√©tences
    if ((skills.speed || 5) > 7) {
        characteristics.push('Vitesse');
    }
    
    if ((skills.strength || 5) > 7) {
        characteristics.push('Puissance physique');
    }
    
    const techniqueScore = (
        (skills.ballControl || 5) +
        (skills.dribbleRight || 5) +
        (skills.dribbleLeft || 5)
    ) / 3;
    
    if (techniqueScore > 7) {
        characteristics.push('Technique pure');
    }
    
    const basketIQScore = (
        (skills.gameReading || 5) +
        (skills.peripheralVision || 5) +
        (skills.tacticalDiscipline || 5)
    ) / 3;
    
    if (basketIQScore > 7) {
        characteristics.push('QI basket √©lev√©');
    }
    
    if ((skills.threePointer || 5) > 7.5) {
        characteristics.push('Adresse longue distance');
    }
    
    if ((skills.postUp || 5) > 7) {
        characteristics.push('Jeu dos au panier');
    }
    
    const defenseScore = (
        (skills.manDefense || 5) +
        (skills.helpDefense || 5) +
        (skills.defensiveCommunication || 5)
    ) / 3;
    
    if (defenseScore > 7) {
        characteristics.push('D√©fense √©lite');
    }
    
    if ((skills.peripheralVision || 5) > 7 && (skills.createForOthers || 5) > 7) {
        characteristics.push('Vision de jeu');
    }
    
    if ((skills.leadership || 5) > 7) {
        characteristics.push('Leadership vocal');
    }
    
    // Si trop peu de caract√©ristiques, ajouter les plus hautes comp√©tences
    if (characteristics.length < 3) {
        const allSkills = Object.entries(skills)
            .map(([key, value]) => ({ name: getCharacteristicFromSkill(key), value }))
            .filter(s => s.value > 6 && !characteristics.includes(s.name))
            .sort((a, b) => b.value - a.value)
            .slice(0, 3 - characteristics.length);
        
        characteristics.push(...allSkills.map(s => s.name));
    }
    
    return characteristics.slice(0, 5);
}

function getCharacteristicFromSkill(skillName) {
    const mapping = {
        speed: 'Vitesse',
        strength: 'Puissance physique',
        agility: 'Agilit√©',
        explosiveness: 'Explosivit√©',
        endurance: 'Endurance',
        coordination: 'Coordination',
        leadership: 'Leadership',
        concentration: 'Concentration',
        fighting: 'Combativit√©',
        teamSpirit: 'Esprit d\'√©quipe'
    };
    
    return mapping[skillName] || 'Polyvalence';
}

function generateRecommendations(analysis, skills) {
    const recommendations = [];
    
    // Recommandations bas√©es sur les faiblesses
    if (analysis.weaknesses.length > 0) {
        analysis.weaknesses.forEach(weakness => {
            if (weakness.name.includes('Throw') || weakness.name.includes('Shot')) {
                recommendations.push('Travailler les fondamentaux du tir');
            }
            if (weakness.name.includes('dribble')) {
                recommendations.push('Am√©liorer le maniement de balle');
            }
            if (weakness.name.includes('Defense')) {
                recommendations.push('Renforcer les principes d√©fensifs');
            }
        });
    }
    
    // Recommandations bas√©es sur le poste
    if (analysis.position.primary.name === 'Meneuse' && (skills.leadership || 5) < 6) {
        recommendations.push('D√©velopper le leadership et la communication');
    }
    
    if (analysis.position.primary.name === 'Pivot' && (skills.strength || 5) < 6) {
        recommendations.push('Programme de renforcement musculaire recommand√©');
    }
    
    return [...new Set(recommendations)].slice(0, 3);
}

function displayProfileAnalysis(player, analysis) {
    // Afficher l'analyse du poste
    const positionHTML = `
        <div style="padding: 15px; background: #f8f9fa; border-radius: 8px; margin-bottom: 15px;">
            <h4 style="color: #4caf50; margin-bottom: 10px;">
                ‚úÖ Poste recommand√© : ${analysis.position.primary.name}
            </h4>
            <p style="color: #666; margin-bottom: 10px;">${analysis.position.primary.reason}</p>
            <div style="display: flex; align-items: center; gap: 10px;">
                <strong>Score de compatibilit√© :</strong>
                <div style="flex: 1; background: #e0e0e0; height: 20px; border-radius: 10px; overflow: hidden;">
                    <div style="width: ${analysis.position.primary.score}%; background: linear-gradient(90deg, #4caf50, #8bc34a); height: 100%;"></div>
                </div>
                <span>${analysis.position.primary.score}%</span>
            </div>
        </div>
        ${analysis.position.secondary ? `
            <div style="padding: 10px; background: #fff3e0; border-radius: 8px;">
                <strong>Poste secondaire :</strong> ${analysis.position.secondary.name} (${analysis.position.secondary.score}%)
            </div>
        ` : ''}
    `;
    
    document.getElementById('positionRecommendation').innerHTML = positionHTML;
    
    // Afficher le profil offensif
    document.getElementById('offensiveProfileAnalysis').innerHTML = `
        <div style="padding: 15px; background: #f3e5f5; border-radius: 8px;">
            <h4 style="color: #6a1b9a; margin-bottom: 10px;">
                ${analysis.offensiveProfile.type}
            </h4>
            <p style="color: #666;">${analysis.offensiveProfile.description}</p>
            <div style="margin-top: 10px;">
                <strong>Score :</strong> ${analysis.offensiveProfile.score.toFixed(1)}/10
            </div>
        </div>
    `;
    
    // Afficher le profil d√©fensif
    document.getElementById('defensiveProfileAnalysis').innerHTML = `
        <div style="padding: 15px; background: #e3f2fd; border-radius: 8px;">
            <h4 style="color: #1565c0; margin-bottom: 10px;">
                ${analysis.defensiveProfile.type}
            </h4>
            <p style="color: #666;">${analysis.defensiveProfile.description}</p>
            <div style="margin-top: 10px;">
                <strong>Score :</strong> ${analysis.defensiveProfile.score.toFixed(1)}/10
            </div>
        </div>
    `;
    
    // Afficher les caract√©ristiques dominantes
    document.getElementById('dominantCharacteristics').innerHTML = `
        <div style="display: flex; flex-wrap: wrap; gap: 10px;">
            ${analysis.characteristics.map(char => `
                <span class="skill-recommendation">${char}</span>
            `).join('')}
        </div>
        ${analysis.recommendations.length > 0 ? `
            <div style="margin-top: 20px; padding: 15px; background: #fff8e1; border-radius: 8px;">
                <h4 style="color: #f57c00; margin-bottom: 10px;">üìù Recommandations</h4>
                <ul style="margin-left: 20px;">
                    ${analysis.recommendations.map(rec => `<li>${rec}</li>`).join('')}
                </ul>
            </div>
        ` : ''}
    `;
    
    // Stocker l'analyse pour application ult√©rieure
    window.currentProfileAnalysis = {
        playerId: player.id,
        analysis: analysis
    };
}

function applyAutoProfile() {
    if (!window.currentProfileAnalysis) {
        alert('Aucune analyse en cours');
        return;
    }
    
    const { playerId, analysis } = window.currentProfileAnalysis;
    const player = players.find(p => p.id === playerId);
    
    if (!player) {
        alert('Joueuse non trouv√©e');
        return;
    }
    
    // Appliquer les recommandations
    player.primaryPosition = analysis.position.primary.name;
    if (analysis.position.secondary && analysis.position.secondary.score > 60) {
        player.secondaryPosition = analysis.position.secondary.name;
    }
    player.offensiveProfile = analysis.offensiveProfile.type;
    player.defensiveProfile = analysis.defensiveProfile.type;
    player.characteristics = analysis.characteristics;
    
    // Sauvegarder
    localStorage.setItem('basketballPlayers', JSON.stringify(players));
    
    // Ajouter √† l'historique
    addToHistory('auto-profile', player, 
        `Profil automatique appliqu√© - ${analysis.position.primary.name} / ${analysis.offensiveProfile.type}`
    );
    
    alert(`Profil mis √† jour pour ${player.firstName} ${player.lastName} !\n\n` +
          `Poste: ${player.primaryPosition}\n` +
          `Profil offensif: ${player.offensiveProfile}\n` +
          `Profil d√©fensif: ${player.defensiveProfile}`);
}
function analyzeAllPlayers() {
    const results = document.getElementById('batchAnalysisResults');
    let analyzedCount = 0;
    let updatedPlayers = [];
    
    players.forEach(player => {
        const playerEvals = evaluations[player.id];
        
        if (playerEvals && playerEvals.length > 0) {
            const lastEval = playerEvals[playerEvals.length - 1];
            const analysis = performProfileAnalysis(player, lastEval.skills);
            
            // Appliquer automatiquement les profils
            player.primaryPosition = analysis.position.primary.name;
            if (analysis.position.secondary && analysis.position.secondary.score > 60) {
                player.secondaryPosition = analysis.position.secondary.name;
            }
            player.offensiveProfile = analysis.offensiveProfile.type;
            player.defensiveProfile = analysis.defensiveProfile.type;
            player.characteristics = analysis.characteristics;
            
            analyzedCount++;
            updatedPlayers.push({
                name: `${player.firstName} ${player.lastName}`,
                position: analysis.position.primary.name,
                offensive: analysis.offensiveProfile.type,
                defensive: analysis.defensiveProfile.type
            });
        }
    });
    
    if (analyzedCount === 0) {
        results.innerHTML = `
            <div class="form-section">
                <p style="text-align: center; color: #666;">
                    Aucune joueuse avec √©valuation disponible pour l'analyse.
                </p>
            </div>
        `;
    } else {
        // Sauvegarder les modifications
        localStorage.setItem('basketballPlayers', JSON.stringify(players));
        
        // Ajouter √† l'historique
        addToHistory('auto-profile', null, 
            `Analyse en lot effectu√©e pour ${analyzedCount} joueuse(s)`
        );
        
        // Afficher les r√©sultats
        results.innerHTML = `
            <div class="form-section">
                <h4 style="color: #4caf50; margin-bottom: 15px;">
                    ‚úÖ Analyse termin√©e : ${analyzedCount} joueuse(s) mise(s) √† jour
                </h4>
                <table class="history-table">
                    <thead>
                        <tr>
                            <th>Joueuse</th>
                            <th>Poste d√©termin√©</th>
                            <th>Profil offensif</th>
                            <th>Profil d√©fensif</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${updatedPlayers.map(p => `
                            <tr>
                                <td>${p.name}</td>
                                <td><span class="badge badge-info">${p.position}</span></td>
                                <td>${p.offensive}</td>
                                <td>${p.defensive}</td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            </div>
        `;
    }
    
    results.style.display = 'block';
}

// ==================== FONCTIONS DE NAVIGATION ET GESTION DES ONGLETS ====================

function switchTab(tabName, buttonElement) {
    // Masquer tous les contenus d'onglets
    const tabs = document.querySelectorAll('.tab-content');
    tabs.forEach(tab => tab.classList.remove('active'));
    
    // D√©sactiver tous les boutons d'onglets
    const buttons = document.querySelectorAll('.tab-btn');
    buttons.forEach(btn => btn.classList.remove('active'));
    
    // Afficher l'onglet s√©lectionn√©
    const targetTab = document.getElementById(tabName);
    if (targetTab) {
        targetTab.classList.add('active');
    }
    
    // Activer le bouton correspondant
    if (buttonElement) {
        buttonElement.classList.add('active');
    }
    
    // Charger les donn√©es sp√©cifiques √† l'onglet
    switch(tabName) {
        case 'dashboard':
            loadDashboard();
            break;
        case 'players':
            loadPlayers();
            break;
        case 'evaluation':
            loadEvaluationPlayers();
            break;
        case 'statistics':
            loadStatisticsPlayers();
            break;
        case 'history':
            loadHistory();
            break;
        case 'autoProfile':
            loadAutoProfilePlayers();
            break;
    }
}

// ==================== FONCTIONS DASHBOARD ====================

function loadDashboard() {
    // Statistiques globales
    document.getElementById('totalPlayers').textContent = players.length;
    
    // Nombre de cat√©gories uniques
    const categories = [...new Set(players.map(p => p.currentCategory || p.category))];
    document.getElementById('categories').textContent = categories.length;
    
    // Nombre total d'√©valuations et note moyenne
    let totalEvals = 0;
    let totalRatings = 0;
    let ratingCount = 0;
    
    Object.values(evaluations).forEach(playerEvals => {
        totalEvals += playerEvals.length;
        playerEvals.forEach(eval => {
            if (eval.globalRating) {
                totalRatings += eval.globalRating;
                ratingCount++;
            }
        });
    });
    
    document.getElementById('evalCount').textContent = totalEvals;
    document.getElementById('avgRating').textContent = ratingCount > 0 ? 
        (totalRatings / ratingCount).toFixed(1) : '0';
    
    // Derni√®res √©valuations
    loadRecentEvaluations();
}

function loadRecentEvaluations() {
    const recentEvals = [];
    
    Object.entries(evaluations).forEach(([playerId, playerEvals]) => {
        const player = players.find(p => p.id === playerId);
        if (player && playerEvals.length > 0) {
            playerEvals.forEach(eval => {
                recentEvals.push({
                    date: eval.date,
                    playerName: `${player.firstName} ${player.lastName}`,
                    rating: eval.globalRating,
                    playerId: playerId
                });
            });
        }
    });
    
    // Trier par date et prendre les 5 derni√®res
    recentEvals.sort((a, b) => new Date(b.date) - new Date(a.date));
    const latest = recentEvals.slice(0, 5);
    
    const tbody = document.getElementById('recentEvaluations');
    if (latest.length === 0) {
        tbody.innerHTML = '<tr><td colspan="5" style="text-align: center; padding: 20px;">Aucune √©valuation r√©cente</td></tr>';
    } else {
        tbody.innerHTML = latest.map((eval, index) => {
            // Calculer la progression (simulation bas√©e sur les √©valuations pr√©c√©dentes)
            const previousEvals = recentEvals.filter(e => 
                e.playerId === eval.playerId && 
                new Date(e.date) < new Date(eval.date)
            );
            
            let progression = 0;
            let progressClass = 'badge-warning';
            
            if (previousEvals.length > 0) {
                progression = eval.rating - previousEvals[0].rating;
                progressClass = progression > 0 ? 'badge-success' : 
                              progression < 0 ? 'badge-danger' : 'badge-warning';
            }
            
            return `
                <tr>
                    <td>${formatDate(eval.date)}</td>
                    <td>${eval.playerName}</td>
                    <td>√âvaluation compl√®te</td>
                    <td>
                        <span class="badge ${progressClass}">
                            ${progression > 0 ? '+' : ''}${progression.toFixed(1)}
                        </span>
                    </td>
                    <td><strong>${eval.rating.toFixed(1)}</strong>/10</td>
                </tr>
            `;
        }).join('');
    }
}

// ==================== FONCTIONS GESTION DES JOUEUSES ====================

function loadPlayers() {
    const grid = document.getElementById('playersGrid');
    
    if (players.length === 0) {
        grid.innerHTML = '<p style="text-align: center; grid-column: 1/-1;">Aucune joueuse enregistr√©e</p>';
        return;
    }
    
    grid.innerHTML = players.map(player => `
        <div class="player-card" onclick="showPlayerProfile('${player.id}')">
            <span class="player-number">${player.number || '--'}</span>
            <h3>${player.firstName} ${player.lastName}</h3>
            <p class="player-info">üìç ${player.primaryPosition || 'Non d√©fini'}</p>
            <p class="player-info">üè∑Ô∏è ${player.currentCategory || player.category}</p>
            <p class="player-info">üë• ${player.currentTeam || 'Non assign√©e'}</p>
            <p class="player-info">üìè ${player.height ? player.height + ' cm' : 'Non renseign√©'}</p>
            <p class="player-info">üéÇ ${calculateAge(player.birthDate)} ans</p>
            ${player.offensiveProfile ? `<p class="player-info">‚öîÔ∏è ${player.offensiveProfile}</p>` : ''}
        </div>
    `).join('');
}

function filterPlayers() {
    const searchTerm = document.getElementById('searchPlayer').value.toLowerCase();
    const categoryFilter = document.getElementById('filterCategory').value;
    const teamFilter = document.getElementById('filterTeam').value;
    const positionFilter = document.getElementById('filterPosition').value;
    
    const filteredPlayers = players.filter(player => {
        const fullName = `${player.firstName} ${player.lastName}`.toLowerCase();
        const matchSearch = fullName.includes(searchTerm);
        const matchCategory = !categoryFilter || 
            player.currentCategory === categoryFilter || 
            player.category === categoryFilter;
        const matchTeam = !teamFilter || player.currentTeam === teamFilter;
        const matchPosition = !positionFilter || 
            player.primaryPosition === positionFilter ||
            player.secondaryPosition === positionFilter;
        
        return matchSearch && matchCategory && matchTeam && matchPosition;
    });
    
    const grid = document.getElementById('playersGrid');
    
    if (filteredPlayers.length === 0) {
        grid.innerHTML = '<p style="text-align: center; grid-column: 1/-1;">Aucun r√©sultat trouv√©</p>';
        return;
    }
    
    grid.innerHTML = filteredPlayers.map(player => `
        <div class="player-card" onclick="showPlayerProfile('${player.id}')">
            <span class="player-number">${player.number || '--'}</span>
            <h3>${player.firstName} ${player.lastName}</h3>
            <p class="player-info">üìç ${player.primaryPosition || 'Non d√©fini'}</p>
            <p class="player-info">üè∑Ô∏è ${player.currentCategory || player.category}</p>
            <p class="player-info">üë• ${player.currentTeam || 'Non assign√©e'}</p>
            <p class="player-info">üìè ${player.height ? player.height + ' cm' : 'Non renseign√©'}</p>
            <p class="player-info">üéÇ ${calculateAge(player.birthDate)} ans</p>
            ${player.offensiveProfile ? `<p class="player-info">‚öîÔ∏è ${player.offensiveProfile}</p>` : ''}
        </div>
    `).join('');
}

function savePlayer(event) {
    event.preventDefault();
    
    const form = event.target;
    const formData = new FormData(form);
    
    // R√©cup√©rer les caract√©ristiques coch√©es
    const characteristics = [];
    document.querySelectorAll('input[name="characteristics"]:checked').forEach(cb => {
        characteristics.push(cb.value);
    });
    
    const player = {
        id: Date.now().toString(),
        firstName: formData.get('firstName'),
        lastName: formData.get('lastName'),
        birthDate: formData.get('birthDate'),
        number: formData.get('number') || null,
        category: formData.get('category'),
        currentCategory: formData.get('currentCategory'),
        currentTeam: formData.get('currentTeam'),
        joinDate: formData.get('joinDate'),
        height: formData.get('height'),
        weight: formData.get('weight'),
        wingspan: formData.get('wingspan'),
        verticalJump: formData.get('verticalJump'),
        dominantHand: formData.get('dominantHand'),
        shoeSize: formData.get('shoeSize'),
        primaryPosition: formData.get('primaryPosition'),
        secondaryPosition: formData.get('secondaryPosition'),
        offensiveProfile: formData.get('offensiveProfile'),
        defensiveProfile: formData.get('defensiveProfile'),
        characteristics: characteristics,
        bloodType: formData.get('bloodType'),
        allergies: formData.get('allergies'),
        emergencyContact: formData.get('emergencyContact'),
        glasses: formData.get('glasses'),
        createdAt: new Date().toISOString()
    };
    
    players.push(player);
    localStorage.setItem('basketballPlayers', JSON.stringify(players));
    
    // Ajouter √† l'historique
    addToHistory('creation', player, 'Nouvelle joueuse ajout√©e');
    
    // R√©initialiser le formulaire
    form.reset();
    
    alert(`Joueuse ${player.firstName} ${player.lastName} ajout√©e avec succ√®s!`);
    
    // Basculer vers l'onglet des joueuses
    const playersButton = document.querySelector('.tab-btn:nth-child(2)');
    switchTab('players', playersButton);
}

function showPlayerProfile(playerId) {
    const player = players.find(p => p.id === playerId);
    if (!player) return;
    
    const modal = document.getElementById('playerModal');
    modal.classList.add('active');
    
    // Informations de base
    document.getElementById('modalPlayerName').textContent = 
        `Profil de ${player.firstName} ${player.lastName}`;
    document.getElementById('modalPlayerInitials').textContent = 
        `${player.firstName[0]}${player.lastName[0]}`;
    document.getElementById('modalFullName').textContent = 
        `${player.firstName} ${player.lastName}`;
    document.getElementById('modalNumber').textContent = player.number || '--';
    document.getElementById('modalPosition').textContent = 
        player.primaryPosition + (player.secondaryPosition ? ` / ${player.secondaryPosition}` : '');
    document.getElementById('modalCategory').textContent = 
        `${player.currentCategory || player.category} (${player.currentTeam || 'Non assign√©e'})`;
    document.getElementById('modalAge').textContent = calculateAge(player.birthDate) + ' ans';
    
    // Profil de jeu
    document.getElementById('modalOffensive').textContent = player.offensiveProfile || '--';
    document.getElementById('modalDefensive').textContent = player.defensiveProfile || '--';
    document.getElementById('modalCharacteristics').textContent = 
        player.characteristics && player.characteristics.length > 0 ? 
        player.characteristics.join(', ') : '--';
    
    // Derni√®re √©valuation
    const playerEvals = evaluations[playerId];
    if (playerEvals && playerEvals.length > 0) {
        const lastEval = playerEvals[playerEvals.length - 1];
        document.getElementById('modalGlobalRating').textContent = lastEval.globalRating.toFixed(1);
        
        // Cr√©er le graphique radar dans le modal
        createModalRadarChart(lastEval.skills);
    } else {
        document.getElementById('modalGlobalRating').textContent = '--';
        
        // Masquer le canvas du graphique
        const canvas = document.getElementById('modalRadarChart');
        if (canvas) canvas.style.display = 'none';
    }
}

function closeModal() {
    document.getElementById('playerModal').classList.remove('active');
    if (modalRadarChart) {
        modalRadarChart.destroy();
        modalRadarChart = null;
    }
}

// ==================== FONCTIONS √âVALUATION ====================

function loadEvaluationPlayers() {
    const select = document.getElementById('playerSelect');
    select.innerHTML = '<option value="">Choisir une joueuse...</option>';
    
    players.forEach(player => {
        const option = document.createElement('option');
        option.value = player.id;
        option.textContent = `${player.firstName} ${player.lastName} (#${player.number || '--'})`;
        select.appendChild(option);
    });
}

function loadPlayerEvaluation() {
    const playerId = document.getElementById('playerSelect').value;
    
    if (!playerId) {
        document.getElementById('evaluationForm').style.display = 'none';
        return;
    }
    
    currentPlayerId = playerId;
    document.getElementById('evaluationForm').style.display = 'block';
    
    // R√©initialiser tous les sliders √† 5
    const sliders = document.querySelectorAll('.skill-slider');
    sliders.forEach(slider => {
        slider.value = 5;
        const valueSpan = document.getElementById(slider.id + 'Value');
        if (valueSpan) valueSpan.textContent = '5';
    });
    
    // Charger les √©valuations existantes si disponibles
    if (evaluations[playerId] && evaluations[playerId].length > 0) {
        const lastEval = evaluations[playerId][evaluations[playerId].length - 1];
        
        // Restaurer toutes les valeurs des sliders
        Object.keys(lastEval.skills).forEach(skillId => {
            const slider = document.getElementById(skillId);
            if (slider) {
                slider.value = lastEval.skills[skillId];
                const valueSpan = document.getElementById(skillId + 'Value');
                if (valueSpan) valueSpan.textContent = lastEval.skills[skillId];
            }
        });
        
        // Restaurer les commentaires
        if (lastEval.coachNotes) {
            document.getElementById('coachNotes').value = lastEval.coachNotes;
        }
        if (lastEval.shortTermGoals) {
            document.getElementById('shortTermGoals').value = lastEval.shortTermGoals;
        }
    }
}

function saveEvaluation() {
    if (!currentPlayerId) {
        alert('Veuillez s√©lectionner une joueuse');
        return;
    }
    
    const player = players.find(p => p.id === currentPlayerId);
    
    const skills = {
        // Tir et Finition
        midRangeShot: parseInt(document.getElementById('midRangeShot').value),
        pullUpShot: parseInt(document.getElementById('pullUpShot').value),
        threePointer: parseInt(document.getElementById('threePointer').value),
        layupRight: parseInt(document.getElementById('layupRight').value),
        layupLeft: parseInt(document.getElementById('layupLeft').value),
        freeThrow: parseInt(document.getElementById('freeThrow').value),
        contactFinish: parseInt(document.getElementById('contactFinish').value),
        floater: parseInt(document.getElementById('floater').value),
        
        // Dribble et Cr√©ation
        dribbleRight: parseInt(document.getElementById('dribbleRight').value),
        dribbleLeft: parseInt(document.getElementById('dribbleLeft').value),
        changeDirection: parseInt(document.getElementById('changeDirection').value),
        penetration: parseInt(document.getElementById('penetration').value),
        createOwnShot: parseInt(document.getElementById('createOwnShot').value),
        ballControl: parseInt(document.getElementById('ballControl').value),
        
        // Passe et Vision
        shortPass: parseInt(document.getElementById('shortPass').value),
        longPass: parseInt(document.getElementById('longPass').value),
        peripheralVision: parseInt(document.getElementById('peripheralVision').value),
        gameReading: parseInt(document.getElementById('gameReading').value),
        createForOthers: parseInt(document.getElementById('createForOthers').value),
        passTiming: parseInt(document.getElementById('passTiming').value),
        
        // D√©fense
        manDefense: parseInt(document.getElementById('manDefense').value),
        helpDefense: parseInt(document.getElementById('helpDefense').value),
        steal: parseInt(document.getElementById('steal').value),
        block: parseInt(document.getElementById('block').value),
        defensiveRebound: parseInt(document.getElementById('defensiveRebound').value),
        defensiveCommunication: parseInt(document.getElementById('defensiveCommunication').value),
        perimeterDefense: parseInt(document.getElementById('perimeterDefense').value),
        postDefense: parseInt(document.getElementById('postDefense').value),
        
        // Jeu Int√©rieur
        postUp: parseInt(document.getElementById('postUp').value),
        hookShot: parseInt(document.getElementById('hookShot').value),
        offensiveRebound: parseInt(document.getElementById('offensiveRebound').value),
        screening: parseInt(document.getElementById('screening').value),
        
        // Physique
        speed: parseInt(document.getElementById('speed').value),
        explosiveness: parseInt(document.getElementById('explosiveness').value),
        agility: parseInt(document.getElementById('agility').value),
        strength: parseInt(document.getElementById('strength').value),
        endurance: parseInt(document.getElementById('endurance').value),
        coordination: parseInt(document.getElementById('coordination').value),
        balance: parseInt(document.getElementById('balance').value),
        
        // Mental
        concentration: parseInt(document.getElementById('concentration').value),
        leadership: parseInt(document.getElementById('leadership').value),
        teamSpirit: parseInt(document.getElementById('teamSpirit').value),
        pressureManagement: parseInt(document.getElementById('pressureManagement').value),
        fighting: parseInt(document.getElementById('fighting').value),
        tacticalDiscipline: parseInt(document.getElementById('tacticalDiscipline').value)
    };
    
    const evaluation = {
        id: Date.now().toString(),
        playerId: currentPlayerId,
        skills: skills,
        coachNotes: document.getElementById('coachNotes').value,
        shortTermGoals: document.getElementById('shortTermGoals').value,
        date: new Date().toISOString(),
        globalRating: calculateGlobalRating(skills)
    };
    
    // Sauvegarder l'√©valuation
    if (!evaluations[currentPlayerId]) {
        evaluations[currentPlayerId] = [];
    }
    evaluations[currentPlayerId].push(evaluation);
    localStorage.setItem('playerEvaluations', JSON.stringify(evaluations));
    
    // Ajouter √† l'historique
    addToHistory('evaluation', player, 
        `√âvaluation compl√©t√©e - Note globale: ${evaluation.globalRating}/10`);
    
    alert(`√âvaluation enregistr√©e pour ${player.firstName} ${player.lastName}\n` +
          `Note globale: ${evaluation.globalRating}/10`);
}

// ==================== FONCTIONS STATISTIQUES ====================

function loadStatisticsPlayers() {
    const select = document.getElementById('statsPlayerSelect');
    select.innerHTML = '<option value="">S√©lectionner une joueuse...</option>';
    
    players.forEach(player => {
        const option = document.createElement('option');
        option.value = player.id;
        option.textContent = `${player.firstName} ${player.lastName} (#${player.number || '--'})`;
        select.appendChild(option);
    });
}

function loadPlayerStats() {
    const playerId = document.getElementById('statsPlayerSelect').value;
    const period = document.getElementById('statsPeriod').value;
    
    if (!playerId) {
        document.getElementById('statsContent').style.display = 'none';
        return;
    }
    
    document.getElementById('statsContent').style.display = 'block';
    
    const playerEvals = evaluations[playerId] || [];
    if (playerEvals.length === 0) {
        document.getElementById('statsContent').innerHTML = 
            '<p style="text-align: center; padding: 40px;">Aucune √©valuation disponible pour cette joueuse</p>';
        return;
    }
    
    // Filtrer selon la p√©riode
    const now = new Date();
    const filteredEvals = playerEvals.filter(eval => {
        const evalDate = new Date(eval.date);
        switch(period) {
            case 'month':
                return (now - evalDate) <= 30 * 24 * 60 * 60 * 1000;
            case '3months':
                return (now - evalDate) <= 90 * 24 * 60 * 60 * 1000;
            case '6months':
                return (now - evalDate) <= 180 * 24 * 60 * 60 * 1000;
            default:
                return true;
        }
    });
    
    if (filteredEvals.length === 0) {
        document.getElementById('statsContent').innerHTML = 
            '<p style="text-align: center; padding: 40px;">Aucune √©valuation dans la p√©riode s√©lectionn√©e</p>';
        return;
    }
    
    // R√©cup√©rer la derni√®re √©valuation
    const lastEval = filteredEvals[filteredEvals.length - 1];
    
    // Calculer les moyennes par cat√©gorie
    const offensiveSkills = ['midRangeShot', 'pullUpShot', 'threePointer', 'layupRight', 
                             'layupLeft', 'freeThrow', 'contactFinish', 'floater',
                             'dribbleRight', 'dribbleLeft', 'changeDirection', 
                             'penetration', 'createOwnShot', 'ballControl'];
    const defensiveSkills = ['manDefense', 'helpDefense', 'steal', 'block', 
                             'defensiveRebound', 'defensiveCommunication',
                             'perimeterDefense', 'postDefense'];
    const physicalSkills = ['speed', 'explosiveness', 'agility', 'strength', 
                            'endurance', 'coordination', 'balance'];
    const mentalSkills = ['concentration', 'leadership', 'teamSpirit', 
                          'pressureManagement', 'fighting', 'tacticalDiscipline'];
    
    const offensiveAvg = calculateCategoryAverage(lastEval.skills, offensiveSkills);
    const defensiveAvg = calculateCategoryAverage(lastEval.skills, defensiveSkills);
    const physicalAvg = calculateCategoryAverage(lastEval.skills, physicalSkills);
    const mentalAvg = calculateCategoryAverage(lastEval.skills, mentalSkills);
    
    // Mettre √† jour les cartes de statistiques
    document.getElementById('avgOffensive').textContent = offensiveAvg.toFixed(1);
    document.getElementById('avgDefensive').textContent = defensiveAvg.toFixed(1);
    document.getElementById('avgPhysical').textContent = physicalAvg.toFixed(1);
    document.getElementById('avgMental').textContent = mentalAvg.toFixed(1);
    
    // Cr√©er le graphique radar
    createRadarChart(lastEval.skills);
    
    // Afficher les points forts et faibles
    displayStrengthsWeaknesses(lastEval.skills);
}

function createRadarChart(skills) {
    const ctx = document.getElementById('radarChart');
    if (!ctx) return;
    
    if (radarChart) {
        radarChart.destroy();
    }
    
    const categories = {
        'Tir': ['midRangeShot', 'threePointer', 'freeThrow'],
        'Dribble': ['dribbleRight', 'dribbleLeft', 'changeDirection'],
        'Passe': ['shortPass', 'longPass', 'createForOthers'],
        'D√©fense': ['manDefense', 'steal', 'defensiveRebound'],
        'Physique': ['speed', 'strength', 'endurance'],
        'Mental': ['concentration', 'leadership', 'pressureManagement']
    };
    
    const data = Object.keys(categories).map(cat => {
        const catSkills = categories[cat];
        return calculateCategoryAverage(skills, catSkills);
    });
    
    radarChart = new Chart(ctx, {
        type: 'radar',
        data: {
            labels: Object.keys(categories),
            datasets: [{
                label: 'Comp√©tences',
                data: data,
                backgroundColor: 'rgba(118, 75, 162, 0.2)',
                borderColor: '#764ba2',
                borderWidth: 2,
                pointBackgroundColor: '#764ba2',
                pointBorderColor: '#fff',
                pointHoverBackgroundColor: '#fff',
                pointHoverBorderColor: '#764ba2'
            }]
        },
        options: {
            scales: {
                r: {
                    beginAtZero: true,
                    max: 10,
                    ticks: {
                        stepSize: 2
                    }
                }
            },
            plugins: {
                legend: {
                    display: false
                }
            }
        }
    });
}

function createModalRadarChart(skills) {
    const canvas = document.getElementById('modalRadarChart');
    if (!canvas) return;
    
    canvas.style.display = 'block';
    const ctx = canvas.getContext('2d');
    
    if (modalRadarChart) {
        modalRadarChart.destroy();
    }
    
    const categories = {
        'Tir': ['midRangeShot', 'threePointer', 'freeThrow'],
        'Dribble': ['dribbleRight', 'dribbleLeft', 'changeDirection'],
        'Passe': ['shortPass', 'longPass', 'createForOthers'],
        'D√©fense': ['manDefense', 'steal', 'defensiveRebound'],
        'Physique': ['speed', 'strength', 'endurance'],
        'Mental': ['concentration', 'leadership', 'pressureManagement']
    };
    
    const data = Object.keys(categories).map(cat => {
        const catSkills = categories[cat];
        return calculateCategoryAverage(skills, catSkills);
    });
    
    modalRadarChart = new Chart(ctx, {
        type: 'radar',
        data: {
            labels: Object.keys(categories),
            datasets: [{
                label: 'Comp√©tences',
                data: data,
                backgroundColor: 'rgba(118, 75, 162, 0.2)',
                borderColor: '#764ba2',
                borderWidth: 2,
                pointBackgroundColor: '#764ba2',
                // Suite de createModalRadarChart() - reprendre apr√®s pointBackgroundColor: '#764ba2',
            pointBorderColor: '#fff',
            pointHoverBackgroundColor: '#fff',
            pointHoverBorderColor: '#764ba2'
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
            r: {
                beginAtZero: true,
                max: 10,
                ticks: {
                    stepSize: 2
                }
            }
        },
        plugins: {
            legend: {
                display: false
            }
        }
    }
});
}

// ==================== FONCTIONS STATISTIQUES (suite) ====================

function displayStrengthsWeaknesses(skills) {
    const skillArray = Object.entries(skills).map(([key, value]) => ({
        name: getSkillDisplayName(key),
        key: key,
        value: value
    }));
    
    // Trier par valeur
    skillArray.sort((a, b) => b.value - a.value);
    
    // Top 5 comp√©tences
    const topSkills = skillArray.slice(0, 5);
    const weakSkills = skillArray.filter(s => s.value <= 5).slice(0, 5);
    
    // Afficher les forces
    const topSkillsDiv = document.getElementById('topSkills');
    if (topSkillsDiv) {
        topSkillsDiv.innerHTML = topSkills.map(skill => `
            <div style="margin-bottom: 10px;">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <span>${skill.name}</span>
                    <span class="badge badge-success">${skill.value}/10</span>
                </div>
                <div style="background: #e0e0e0; height: 8px; border-radius: 4px; margin-top: 5px;">
                    <div style="width: ${skill.value * 10}%; background: #4caf50; height: 100%; border-radius: 4px;"></div>
                </div>
            </div>
        `).join('');
    }
    
    // Afficher les faiblesses
    const weakSkillsDiv = document.getElementById('weakSkills');
    if (weakSkillsDiv) {
        weakSkillsDiv.innerHTML = weakSkills.map(skill => `
            <div style="margin-bottom: 10px;">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <span>${skill.name}</span>
                    <span class="badge ${skill.value < 4 ? 'badge-danger' : 'badge-warning'}">${skill.value}/10</span>
                </div>
                <div style="background: #e0e0e0; height: 8px; border-radius: 4px; margin-top: 5px;">
                    <div style="width: ${skill.value * 10}%; background: ${skill.value < 4 ? '#f44336' : '#ff9800'}; height: 100%; border-radius: 4px;"></div>
                </div>
            </div>
        `).join('');
    }
}

// ==================== FONCTIONS HISTORIQUE ====================

function loadHistory() {
    displayHistory(history);
}

function displayHistory(entries) {
    const tbody = document.getElementById('historyTable');
    
    if (!tbody) return;
    
    if (entries.length === 0) {
        tbody.innerHTML = '<tr><td colspan="5" style="text-align: center; padding: 20px;">Aucun historique disponible</td></tr>';
        return;
    }
    
    // Trier par date d√©croissante
    entries.sort((a, b) => new Date(b.date) - new Date(a.date));
    
    tbody.innerHTML = entries.map(entry => {
        let badgeClass = '';
        let badgeIcon = '';
        
        switch(entry.type) {
            case 'creation':
                badgeClass = 'badge-success';
                badgeIcon = '‚ûï';
                break;
            case 'evaluation':
                badgeClass = 'badge-info';
                badgeIcon = 'üìä';
                break;
            case 'modification':
                badgeClass = 'badge-warning';
                badgeIcon = '‚úèÔ∏è';
                break;
            case 'import':
                badgeClass = 'badge-info';
                badgeIcon = 'üì•';
                break;
            case 'auto-profile':
                badgeClass = 'badge-success';
                badgeIcon = 'ü§ñ';
                break;
            default:
                badgeClass = 'badge-secondary';
                badgeIcon = 'üìù';
        }
        
        return `
            <tr>
                <td>${formatDateTime(entry.date)}</td>
                <td><span class="badge ${badgeClass}">${badgeIcon} ${entry.type}</span></td>
                <td>${entry.playerName || '--'}</td>
                <td>${entry.description}</td>
                <td>${entry.user}</td>
            </tr>
        `;
    }).join('');
}

function filterHistory() {
    const searchTerm = (document.getElementById('searchHistory')?.value || '').toLowerCase();
    const typeFilter = document.getElementById('filterHistoryType')?.value || '';
    const dateFilter = document.getElementById('filterHistoryDate')?.value || '';
    
    const filtered = history.filter(entry => {
        const matchSearch = !searchTerm || 
            (entry.playerName && entry.playerName.toLowerCase().includes(searchTerm)) || 
            (entry.description && entry.description.toLowerCase().includes(searchTerm));
        const matchType = !typeFilter || entry.type === typeFilter;
        const matchDate = !dateFilter || entry.date.startsWith(dateFilter);
        
        return matchSearch && matchType && matchDate;
    });
    
    displayHistory(filtered);
}

function addToHistory(type, player, description) {
    const entry = {
        id: Date.now().toString(),
        date: new Date().toISOString(),
        type: type,
        playerName: player ? `${player.firstName} ${player.lastName}` : 'N/A',
        playerId: player ? player.id : null,
        description: description,
        user: 'Coach' // Pourrait √™tre dynamique avec un syst√®me d'authentification
    };
    
    history.push(entry);
    
    // Limiter l'historique √† 500 entr√©es pour √©viter de surcharger le localStorage
    if (history.length > 500) {
        history = history.slice(-500);
    }
    
    localStorage.setItem('historyLog', JSON.stringify(history));
}

// ==================== FONCTIONS PROFILS AUTO ====================

function loadAutoProfilePlayers() {
    const select = document.getElementById('autoProfileSelect');
    if (!select) return;
    
    select.innerHTML = '<option value="">Choisir une joueuse...</option>';
    
    players.forEach(player => {
        const hasEval = evaluations[player.id] && evaluations[player.id].length > 0;
        const option = document.createElement('option');
        option.value = player.id;
        option.textContent = `${player.firstName} ${player.lastName} (#${player.number || '--'})${hasEval ? '' : ' ‚ö†Ô∏è Sans √©valuation'}`;
        if (!hasEval) {
            option.style.color = '#999';
        }
        select.appendChild(option);
    });
}

// ==================== FONCTIONS UTILITAIRES ====================

function calculateAge(birthDate) {
    if (!birthDate) return '--';
    
    const birth = new Date(birthDate);
    const today = new Date();
    let age = today.getFullYear() - birth.getFullYear();
    const monthDiff = today.getMonth() - birth.getMonth();
    
    if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birth.getDate())) {
        age--;
    }
    
    return age;
}

function formatDate(dateString) {
    if (!dateString) return '--';
    
    const date = new Date(dateString);
    if (isNaN(date.getTime())) return '--';
    
    return date.toLocaleDateString('fr-FR', {
        day: '2-digit',
        month: '2-digit',
        year: 'numeric'
    });
}

function formatDateTime(dateString) {
    if (!dateString) return '--';
    
    const date = new Date(dateString);
    if (isNaN(date.getTime())) return '--';
    
    return date.toLocaleDateString('fr-FR', {
        day: '2-digit',
        month: '2-digit',
        year: 'numeric',
        hour: '2-digit',
        minute: '2-digit'
    });
}

function calculateGlobalRating(skills) {
    // Pond√©ration par cat√©gorie pour une √©valuation plus √©quilibr√©e
    const categories = {
        shooting: {
            skills: ['midRangeShot', 'pullUpShot', 'threePointer', 'layupRight', 'layupLeft', 'freeThrow', 'contactFinish', 'floater'],
            weight: 0.20
        },
        ballHandling: {
            skills: ['dribbleRight', 'dribbleLeft', 'changeDirection', 'penetration', 'createOwnShot', 'ballControl'],
            weight: 0.15
        },
        passing: {
            skills: ['shortPass', 'longPass', 'peripheralVision', 'gameReading', 'createForOthers', 'passTiming'],
            weight: 0.15
        },
        defense: {
            skills: ['manDefense', 'helpDefense', 'steal', 'block', 'defensiveRebound', 'defensiveCommunication', 'perimeterDefense', 'postDefense'],
            weight: 0.20
        },
        interior: {
            skills: ['postUp', 'hookShot', 'offensiveRebound', 'screening'],
            weight: 0.10
        },
        physical: {
            skills: ['speed', 'explosiveness', 'agility', 'strength', 'endurance', 'coordination', 'balance'],
            weight: 0.10
        },
        mental: {
            skills: ['concentration', 'leadership', 'teamSpirit', 'pressureManagement', 'fighting', 'tacticalDiscipline'],
            weight: 0.10
        }
    };
    
    let totalScore = 0;
    
    Object.values(categories).forEach(category => {
        const categorySkills = category.skills.filter(skill => skills[skill] !== undefined);
        if (categorySkills.length > 0) {
            const categoryAvg = categorySkills.reduce((sum, skill) => sum + (skills[skill] || 5), 0) / categorySkills.length;
            totalScore += categoryAvg * category.weight;
        }
    });
    
    return parseFloat(totalScore.toFixed(1));
}

function calculateCategoryAverage(skills, categoryKeys) {
    const validSkills = categoryKeys.filter(key => skills[key] !== undefined);
    
    if (validSkills.length === 0) return 0;
    
    const sum = validSkills.reduce((acc, key) => acc + (skills[key] || 0), 0);
    return sum / validSkills.length;
}

function getSkillDisplayName(skillId) {
    const names = {
        // Tir et Finition
        midRangeShot: 'Tir mi-distance',
        pullUpShot: 'Tir apr√®s dribble',
        threePointer: 'Tir √† 3 points',
        layupRight: 'Lay-up main droite',
        layupLeft: 'Lay-up main gauche',
        freeThrow: 'Lancer franc',
        contactFinish: 'Finition au contact',
        floater: 'Floater',
        
        // Dribble et Cr√©ation
        dribbleRight: 'Dribble main droite',
        dribbleLeft: 'Dribble main gauche',
        changeDirection: 'Changement de direction',
        penetration: 'P√©n√©tration',
        createOwnShot: 'Cr√©ation pour soi',
        ballControl: 'Contr√¥le du ballon',
        
        // Passe et Vision
        shortPass: 'Passe courte',
        longPass: 'Passe longue',
        peripheralVision: 'Vision p√©riph√©rique',
        gameReading: 'Lecture du jeu',
        createForOthers: 'Cr√©ation pour les autres',
        passTiming: 'Timing de passe',
        
        // D√©fense
        manDefense: 'D√©fense individuelle',
        helpDefense: 'Aide d√©fensive',
        steal: 'Interception',
        block: 'Contre',
        defensiveRebound: 'Rebond d√©fensif',
        defensiveCommunication: 'Communication d√©fensive',
        perimeterDefense: 'D√©fense p√©rim√®tre',
        postDefense: 'D√©fense poste bas',
        
        // Jeu Int√©rieur
        postUp: 'Jeu dos au panier',
        hookShot: 'Hook shot',
        offensiveRebound: 'Rebond offensif',
        screening: '√âcrans',
        
        // Physique
        speed: 'Vitesse',
        explosiveness: 'Explosivit√©',
        agility: 'Agilit√©',
        strength: 'Force',
        endurance: 'Endurance',
        coordination: 'Coordination',
        balance: '√âquilibre',
        
        // Mental
        concentration: 'Concentration',
        leadership: 'Leadership',
        teamSpirit: 'Esprit d\'√©quipe',
        pressureManagement: 'Gestion de la pression',
        fighting: 'Combativit√©',
        tacticalDiscipline: 'Discipline tactique'
    };
    
    return names[skillId] || skillId;
}

// ==================== INITIALISATION ET EVENT LISTENERS ====================

document.addEventListener('DOMContentLoaded', function() {
    // Protection contre les erreurs de chargement
    try {
        // Initialiser les sliders d'√©valuation
        const sliders = document.querySelectorAll('.skill-slider');
        sliders.forEach(slider => {
            slider.addEventListener('input', function() {
                const valueSpan = document.getElementById(this.id + 'Value');
                if (valueSpan) {
                    valueSpan.textContent = this.value;
                }
            });
        });
        
        // Fermer le modal au clic ext√©rieur
        const modal = document.getElementById('playerModal');
        if (modal) {
            modal.addEventListener('click', function(e) {
                if (e.target === this) {
                    closeModal();
                }
            });
        }
        
        // Charger le dashboard au d√©marrage si la fonction existe
        if (typeof loadDashboard === 'function') {
            loadDashboard();
        }
        
    } catch (error) {
        console.error('Erreur lors de l\'initialisation:', error);
    }
});

// Fonction pour v√©rifier la taille du localStorage
function checkLocalStorageSize() {
    let totalSize = 0;
    
    for (let key in localStorage) {
        if (localStorage.hasOwnProperty(key)) {
            totalSize += localStorage[key].length + key.length;
        }
    }
    
    // Convertir en KB
    const sizeInKB = (totalSize / 1024).toFixed(2);
    
    // Avertir si on approche de la limite (g√©n√©ralement 5-10MB)
    if (sizeInKB > 4000) { // 4MB
        console.warn(`Attention : Le stockage local utilise ${sizeInKB}KB. Consid√©rez l'export des donn√©es anciennes.`);
    } else {
        console.log(`Stockage local : ${sizeInKB}KB utilis√©s`);
    }
}

// Fonction d'export des donn√©es (bonus)
function exportAllData() {
    const allData = {
        players: players,
        evaluations: evaluations,
        history: history,
        exportDate: new Date().toISOString(),
        version: '1.0'
    };
    
    const json = JSON.stringify(allData, null, 2);
    const blob = new Blob([json], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    
    const link = document.createElement('a');
    link.href = url;
    link.download = `basketball_club_data_${formatDate(new Date().toISOString()).replace(/\//g, '-')}.json`;
    link.click();
    
    URL.revokeObjectURL(url);
}

// Fonction d'import des donn√©es (bonus)
function importAllData(file) {
    const reader = new FileReader();
    
    reader.onload = function(e) {
        try {
            const data = JSON.parse(e.target.result);
            
            if (confirm('Cette action remplacera toutes les donn√©es actuelles. Continuer ?')) {
                players = data.players || [];
                evaluations = data.evaluations || {};
                history = data.history || [];
                
                localStorage.setItem('basketballPlayers', JSON.stringify(players));
                localStorage.setItem('playerEvaluations', JSON.stringify(evaluations));
                localStorage.setItem('historyLog', JSON.stringify(history));
                
                alert('Import r√©ussi ! La page va se recharger.');
                location.reload();
            }
        } catch (error) {
            alert('Erreur lors de l\'import : ' + error.message);
        }
    };
    
    reader.readAsText(file);
}

// Initialisation au chargement de la page
window.onload = function() {
    // S'assurer que le dashboard est charg√©
    const dashboardTab = document.getElementById('dashboard');
    if (dashboardTab && !dashboardTab.classList.contains('active')) {
        dashboardTab.classList.add('active');
    }
    
    loadDashboard();
    
    console.log('Syst√®me de suivi basketball - Charg√© avec succ√®s');
    console.log(`${players.length} joueuse(s) en base`);
    console.log(`${Object.keys(evaluations).length} joueuse(s) √©valu√©e(s)`);
    console.log(`${history.length} entr√©e(s) dans l'historique`);
};

// ==================== FIN DU CODE JAVASCRIPT ====================
    </script>
</body>
</html>
